$(function(){!function(e){e.ruler=function(){e("body").append('<div class="modal fade bs-example-modal-sm" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" id="rulerModal"><div class="modal-dialog modal-sm" role="document"> <div class="modal-content"> <div class="modal-header"> <h4 class="modal-title">生成指定坐标线</h4> </div> <div class="modal-body"> <label><input type="radio" checked="checked" class="form-group-sm" name="coord" id="createX"/>X</label><label><input type="radio" class="form-group-sm" name="coord" id="createY"/>Y</label><input type="number" class="form-control" id="coordCreat"/></div><div class="modal-footer"><button class="btn btn-primary" id="rulerOk" data-dismiss="modal">确定</button><button class="btn btn-warning" data-dismiss="modal">取消</button></div></div></div></div>');var o=e("#stage"),n=null,s=!1,t=!1,i=!1;e('<div id="rulerX" class="ruler"></div><div id="rulerY" class="ruler"></div><div id="dotLineX"></div><div id="dotLineY"></div><span id="coordNum"></span>').appendTo(o);var l=e("#dotLineX"),r=e("#dotLineY"),a=e("#coordNum"),d={drawRulerNum:function(){var o=e("#rulerX"),n=e("#rulerY");o.css("width","2000px"),n.css("height","1000px");for(var s=0;s<2e3;s++)s%50==0&&e('<span class="rulerNumX">'+s+"</span>").css("left",s+2).appendTo(o);for(var s=0;s<1e3;s++)s%50==0&&e('<span class="rulerNumY">'+s+"</span>").css("top",s+2).appendTo(n)},drawLineX:function(){console.log(2);var n="lineX"+(e(".lineX").length+1);return e('<div class="lineX line"></div>').appendTo(o).attr({id:n}).css("top","0"),e("#"+n)},drawLineY:function(){var n="lineY"+(e(".lineY").length+1);return e('<div class="lineY line"></div>').appendTo(o).attr({id:n}).css("left","0"),e("#"+n)},dragX:function(){t=!0,r.hide(),s&&o.on("mousemove",function(o){if(s){var n=o.pageY-e(this).offset().top,t=o.pageX-e(this).offset().left;n=parseInt(n),l.show().css("top",n),a.css({top:n,left:t+15}).text(n).show()}})},dragY:function(){t=!0,l.hide(),s&&o.on("mousemove",function(o){if(s){var n=o.pageX-e(this).offset().left,t=o.pageY-e(this).offset().top;n=parseInt(n),r.show().css("left",n),a.css({top:t+15,left:n}).text(n).show()}})},rulerControl:function(){var o=e(".ruler");e("#ruler").on("click",function(){"none"===o.css("display")?(o.show(),e(".line").show(),i=!0):(o.hide(),e(".line").hide(),i=!1)})},init:function(){d.drawRulerNum(),d.rulerControl()}};d.init(),e("#rulerX").on("mousedown",function(e){n=d.drawLineX(),s=!0,d.dragX()}).mouseup(function(){n.remove(),s=!1,n=null,l.hide()}).mousemove(function(){return!1}),e("#rulerY").on("mousedown",function(e){n=d.drawLineY(),s=!0,d.dragY()}).mouseup(function(){n.remove(),r.hide(),n=null,s=!1}).mousemove(function(){return!1}),o.on("mousedown",".lineX",function(){n=e(this),s=!0,d.dragX()}),o.on("mousedown",".lineY",function(){n=e(this),s=!0,d.dragY()}),o.on("mouseup",function(o){if(e(this).unbind("mousemove"),s=!1,n)if(n.hasClass("lineX")){var i=o.pageY-e(this).offset().top;i=parseInt(i),n.css("top",i)}else{var d=o.pageX-e(this).offset().left;d=parseInt(d),n.css("left",d)}n=null,l.hide(),r.hide(),a.hide(),t=!1}),e(window).keyup(function(o){var n=e("div.line"),s=o.keyCode;82===s&&"block"===e(".ruler").css("display")&&e("#rulerModal").modal(),83===s&&n.length>0&&("block"===n.css("display")?n.hide():n.show()),67===s&&n.length>0&&n.remove()}),e("#rulerOk").click(function(){var o=e("#myStageTable"),s=o.css("width").replace("px",""),t=o.css("height").replace("px",""),i=parseInt(e("#coordCreat").val());e("#createX").prop("checked")?0<i&&i<=t?(n=d.drawLineX(),n.css("top",i+"px"),n=null):alert("超出设置范围"):0<i&&i<=s?(n=d.drawLineY(),n.css("left",i+"px"),n=null):alert("超出设置范围")}),o.on("mouseover",".lineX",function(o){if(!t){var n=o.pageX-e(this).offset().left;n=parseInt(n);var s=e(this).css("top");a.css({top:s,left:n+"px"}).text(s.replace("px","")).stop().fadeIn(200)}}).on("mouseout",".lineX",function(){s||(a.stop().fadeOut(800),t=!1)}),o.on("mouseover",".lineY",function(o){if(!t){var n=o.pageY-e(this).offset().top;n=parseInt(n);var s=e(this).css("left");a.css({top:n+"px",left:s}).text(s.replace("px","")).stop().fadeIn(200)}}).on("mouseout",".lineY",function(){s||(a.stop().fadeOut(800),t=!1)}),e(".runProject").click(function(){i&&(e(".ruler").hide(),e(".line").hide())}),e(".offProject").click(function(){i&&(e(".ruler").show(),e(".line").show())})},e.ruler()}(jQuery)});