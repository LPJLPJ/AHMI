ideServices.service("FontGeneratorService",["Type",function(n){function t(n,t){c.width=n,c.height=t,d.clearRect(0,0,n,t)}function i(n,t,i){d.fillText(String.fromCharCode(n),t,i)}function o(n,t,o){d.font=t,d.textAlign="center",d.textBaseline="middle";for(var e=0,a=0,f=0;f<128;f++)a=Math.ceil(f/l.w),e=f-(a-1)*l.w,o.showGrid&&d.strokeRect((e-1)*n,(a-1)*n,n,n),46===f?i(f,(e-.7)*n,(a-.5)*n):i(f,(e-.5)*n,(a-.5)*n);return c.toDataURL()}function e(n,t){var i=Math.ceil(Math.sqrt(t));return i?{w:i,h:i}:null}function a(n,i){var a=n["font-size"]||24;i=i||{};var f=i.paddingRatio||1;if(paddingFontSize=Math.ceil(f*a),l=e(paddingFontSize,128)){t(l.w*paddingFontSize,l.h*paddingFontSize);var r=(n["font-italic"]||"")+" "+(n["font-variant"]||"")+" "+(n["font-bold"]||"")+" "+a+'px "'+n["font-family"]+'"';return o(paddingFontSize,r,i)}console.log("font num invalid")}function f(t){var i,o=[];return i=t.filter(function(t){return t.subType===n.MyNum||t.subType===n.MyDateTime}),i.forEach(function(n){var t,i=n.info,e={},a=i.fontFamily;if(new RegExp("[\\u4E00-\\u9FFF]+","g").test(a)){for(var f="",r=0;r<a.length;r++)f+=a.charCodeAt(r).toString(32);a=f}console.log("fontFamily",a),n.originFont={},n.originFont.src="\\"+a+"-"+i.fontSize+"-"+i.fontBold+"-"+(i.fontItalic||"null")+".png",n.originFont.w=i.fontSize,n.originFont.h=i.fontSize,n.originFont.W=Math.ceil(i.fontSize*g),n.originFont.H=Math.ceil(i.fontSize*g),n.originFont.paddingX=Math.ceil(i.fontSize*(g-1)/2),n.originFont.paddingY=Math.ceil(i.fontSize*(g-1)/2),n.originFont.paddingRatio=g,(t=o.some(function(n){return n.fontFamily===i.fontFamily&&n.fontSize===i.fontSize&&n.fontBold===i.fontBold&&n.fontItalic===i.fontItalic}))||(e["font-family"]=i.fontFamily,e["font-size"]=i.fontSize,e["font-bold"]=i.fontBold,e["font-italic"]=i.fontItalic,o.push(e))}),o}function r(n,t){if(t){return new Buffer(n.split(",")[1],"base64")}return n}var l,c=document.createElement("canvas"),d=c.getContext("2d"),g=1.2;this.generateSingleFont=a,this.getFontCollections=f,this.pngStream=r}]);