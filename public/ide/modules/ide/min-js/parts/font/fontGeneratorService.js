ideServices.service("FontGeneratorService",["Type",function(t){function n(t,n){c.width=t,c.height=n,d.clearRect(0,0,t,n)}function i(t,n,i){d.fillText(String.fromCharCode(t),n,i)}function o(t,n,o){d.font=n,d.textAlign="center",d.textBaseline="middle";for(var e=0,r=0,a=0;a<128;a++)r=Math.ceil(a/l.w),e=a-(r-1)*l.w,o.showGrid&&d.strokeRect((e-1)*t,(r-1)*t,t,t),46===a?i(a,(e-.7)*t,(r-.5)*t):i(a,(e-.5)*t,(r-.5)*t);return c.toDataURL()}function e(t,n){var i=Math.ceil(Math.sqrt(n));return i?{w:i,h:i}:null}function r(t,i){var r=t["font-size"]||24;i=i||{};var a=i.paddingRatio||1;if(paddingFontSize=Math.ceil(a*r),l=e(paddingFontSize,128)){n(l.w*paddingFontSize,l.h*paddingFontSize);var f=(t["font-italic"]||"")+" "+(t["font-variant"]||"")+" "+(t["font-bold"]||"")+" "+r+'px "'+t["font-family"]+'"';return o(paddingFontSize,f,i)}console.log("font num invalid")}function a(n){var i,o=[];return i=n.filter(function(n){return n.subType===t.MyNum||n.subType===t.MyDateTime}),i.forEach(function(t){var n,i=t.info,e={},r=i.fontFamily;if(new RegExp("[\\u4E00-\\u9FFF]+","g").test(r)){for(var a="",f=0;f<r.length;f++)a+=r.charCodeAt(f).toString(32);r=a}t.originFont={},t.originFont.src="\\"+r+"-"+i.fontSize+"-"+i.fontBold+"-"+(i.fontItalic||"null")+".png",t.originFont.w=i.fontSize,t.originFont.h=i.fontSize,t.originFont.W=Math.ceil(i.fontSize*g),t.originFont.H=Math.ceil(i.fontSize*g),t.originFont.paddingX=Math.ceil(i.fontSize*(g-1)/2),t.originFont.paddingY=Math.ceil(i.fontSize*(g-1)/2),t.originFont.paddingRatio=g,(n=o.some(function(t){return t.fontFamily===i.fontFamily&&t.fontSize===i.fontSize&&t.fontBold===i.fontBold&&t.fontItalic===i.fontItalic}))||(e["font-family"]=i.fontFamily,e["font-size"]=i.fontSize,e["font-bold"]=i.fontBold,e["font-italic"]=i.fontItalic,o.push(e))}),o}function f(t,n){if(n){return new Buffer(t.split(",")[1],"base64")}return t}var l,c=document.createElement("canvas"),d=c.getContext("2d"),g=1.2;this.generateSingleFont=r,this.getFontCollections=a,this.pngStream=f}]);