ide.controller("ThumbCtrl",["$scope","$timeout","ProjectService","GlobalService","TemplateProvider","OperateQueService",function(e,n,t,o,i,u){function c(){e.component={addPage:null,uitree:null,menuOptions:[],allContextMenus:[],out:{toolShow:!1}}}function a(){e.component.allContextMenus=[["复制",function(e){f(e.$parent.$index)}],["删除",function(e){l(e.$parent.$index)},function(e){return!0}],["粘贴",function(e){p()}]],e.component.menuOptions=[e.component.allContextMenus[0],null,e.component.allContextMenus[1]],t.getProjectTo(e),e.component.addPage=g,e.component.selectThumb=m,e.component.uitree=t.BindPageTree(function(n){m(e.project.pages[n.source.index])},function(n,t){m(e.project.pages[n.dest.index])}),e.$on("PageNodeChanged",function(){r()}),e.$on("ToolShowChanged",function(n,t){e.component.out.toolShow=t}),e.$on("ProjectUpdated",function(){t.getProjectTo(e)})}function r(){n(function(){t.getProjectTo(e)})}function l(o){var i=t.SaveCurrentOperate();console.log("i am delete a page in thumbCtrl",i),n(function(){t.DeletePageByIndex(o,function(){e.$emit("SwitchCurrentPage",i,function(){})})})}function f(o){console.log("复制的是"+o),n(function(){t.CopyPageByIndex(o,function(){d(),e.$emit("ChangeCurrentPage")})})}function p(){if(t.isRendering())return void console.warn("粘贴被拒绝");var o=t.SaveCurrentOperate();n(function(){t.PastePageByIndex(function(){d(),e.$emit("AddNewPage",o,function(){})})})}function d(){var n=t.shearPagePlateEnable();e.component.menuOptions=n?[e.component.allContextMenus[0],null,e.component.allContextMenus[2],null,e.component.allContextMenus[1]]:[e.component.allContextMenus[0],null,e.component.allContextMenus[1]]}function g(){if(t.isRendering())return void console.warn("创建被拒绝");var n=t.SaveCurrentOperate(),o=i.getDefaultPage();t.AddNewPage(o,function(){e.$emit("AddNewPage",n,function(){})})}function m(n){if(n&&n.id)for(var o=0;o<e.project.pages.length;o++)if(e.project.pages[o].id==n.id){t.changeCurrentPageIndex(o,function(n){var o=t.SaveCurrentOperate();n?e.$emit("ChangeCurrentPage",o,function(){}):e.$emit("SwitchCurrentPage")});break}}e.$on("GlobalProjectReceived",function(){c(),a(),e.$emit("LoadUp")})}]);