ide.controller("ThumbCtrl",["$scope","$timeout","ProjectService","GlobalService","TemplateProvider","OperateQueService",function(n,e,t,o,u,i){function c(){n.component={addPage:null,uitree:null,menuOptions:[],allContextMenus:[],out:{toolShow:!1}}}function a(){n.component.allContextMenus=[["复制",function(n){var e=n.$parent.$index;f(e)}],["删除",function(n){var e=n.$parent.$index;l(e)},function(n){return!0}],["粘贴",function(n){p()}]],n.component.menuOptions=[n.component.allContextMenus[0],null,n.component.allContextMenus[1]],t.getProjectTo(n),n.component.addPage=d,n.component.selectThumb=m,n.component.uitree=t.BindPageTree(function(e){m(n.project.pages[e.source.index])},function(e,t){m(n.project.pages[e.dest.index],function(){n.$emit("ChangeCurrentPage",t)})}),n.$on("PageNodeChanged",function(){r()}),n.$on("ToolShowChanged",function(e,t){n.component.out.toolShow=t}),n.$on("ProjectUpdated",function(){t.getProjectTo(n)})}function r(){e(function(){t.getProjectTo(n)})}function l(o){var u=t.SaveCurrentOperate();e(function(){t.DeletePageByIndex(o,function(){n.$emit("SwitchCurrentPage",u,function(){})})})}function f(o){e(function(){t.CopyPageByIndex(o,function(){g(),n.$emit("ChangeCurrentPage")})})}function p(){if(!t.isRendering()){var o=t.SaveCurrentOperate();e(function(){t.PastePageByIndex(function(){g(),n.$emit("AddNewPage",o,function(){})})})}}function g(){var e=t.shearPagePlateEnable();e?n.component.menuOptions=[n.component.allContextMenus[0],null,n.component.allContextMenus[2],null,n.component.allContextMenus[1]]:n.component.menuOptions=[n.component.allContextMenus[0],null,n.component.allContextMenus[1]]}function d(){if(!t.isRendering()){var e=t.SaveCurrentOperate(),o=u.getDefaultPage();t.AddNewPage(o,function(){n.$emit("AddNewPage",e,function(){})})}}function m(o){o&&o.id&&e(function(){for(var e=0;e<n.project.pages.length;e++)if(n.project.pages[e].id==o.id){t.changeCurrentPageIndex(e,function(e){var o=t.SaveCurrentOperate();e?n.$emit("ChangeCurrentPage",o,function(){}):n.$emit("SwitchCurrentPage")});break}})}n.$on("GlobalProjectReceived",function(){c(),a(),n.$emit("LoadUp")})}]);