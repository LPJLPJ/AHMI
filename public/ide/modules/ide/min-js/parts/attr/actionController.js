ide.controller("ActionCtl",["$scope","ActionService","TagService","$uibModal","ProjectService","Type","OperationService",function(e,t,n,c,o,a,i){function s(){e.status={collapsed:!1},r(),e.tags=n.getAllCustomTags(),e.timerTags=n.getAllTimerTags(),e.collapse=function(t){e.status.collapsed=!e.status.collapsed},e.animationsEnabled=!0}function r(){if(!o.getCurrentSelectObject())return void console.warn("空!");var n=o.getCurrentSelectObject().level,c=_.cloneDeep(n.actions);t.setActions(c),e.actions=t.getAllActions(),e.triggers=t.getTriggers(o.getCurrentSelectObject().level.type);var i=_.cloneDeep(o.getCurrentSelectObject().level);if(!i)return void console.warn("空!");switch(i.type){case a.MyButton:case a.MyNumber:case a.MyProgress:case a.MyDashboard:case a.MyButtonGroup:case a.MySubLayer:case a.MyPage:case a.MyNum:case a.MyImage:case a.MyScriptTrigger:case a.MySlideBlock:e.showActionPanel=!0;break;case a.MySlide:case a.MySwitch:default:e.showActionPanel=!1}switch(i.type){case a.MyPage:e.showAddActionPanel=!0;break;default:e.showAddActionPanel=!1}}function l(){e.$on("AttributeChanged",function(){r()}),e.deleteAction=function(n){t.deleteActionByIndex(n,function(){e.actions=t.getAllActions()}.bind(this))},e.openPanel=function(n){e.selectedIdx=n;var o;-1==n?o=t.getNewAction():n>=0&&n<e.actions.length&&(o=_.cloneDeep(e.actions[n])),c.open({animation:e.animationsEnabled,templateUrl:"actionPanelModal.html",controller:"ActionInstanceCtrl",size:"lg",resolve:{action:function(){return o},triggers:function(){return e.triggers},tags:function(){return e.tags},timerTags:function(){return e.timerTags}}}).result.then(function(n){-1==e.selectedIdx?t.appendAction(n,function(){e.actions=t.getAllActions()}.bind(this)):e.selectedIdx>=0&&e.selectedIdx<e.actions.length&&t.updateActionByIndex(n,e.selectedIdx,function(){e.actions=t.getAllActions()}.bind(this))},function(){console.log("Modal dismissed at: "+new Date)})}}e.$on("GlobalProjectReceived",function(){s(),l(),e.$emit("LoadUp")})}]).controller("ActionInstanceCtrl",["$scope","$uibModalInstance","action","triggers","tags","timerTags","OperationService",function(e,t,n,c,o,a,i){var s=[{name:"",symbol:""},{tag:"",value:""},{tag:"",value:""}];e.ops=i.getOperations(),e.tags=_.map(o.filter(function(e){return"default"==e.bindMod}),"name"),e.timerTags=_.map(a,function(e){return e.name}),e.action=n,e.triggers=c,e.currentChosenIdx=e.action.commands.length-1,e.currentChosenIdx>0?e.chosenCmd=e.action.commands[e.currentChosenIdx]:e.chosenCmd=_.cloneDeep(s),e.chooseCmd=function(t){e.currentChosenIdx=t,e.chosenCmd=e.action.commands[t]},e.addNewCmd=function(){e.action.commands.splice(e.currentChosenIdx+1,0,_.cloneDeep(s)),e.currentChosenIdx+=1,e.chosenCmd=e.action.commands[e.currentChosenIdx],""==e.action.trigger&&toastr.error("未选择触发方式！")},e.deleteCmd=function(t){e.action.commands.splice(t,1),e.currentChosenIdx-=1},e.save=function(){t.close(e.action)},e.cancel=function(){t.dismiss("cancel")}}]);