ide.controller("ActionCtl",["$scope","ActionService","TagService","$uibModal","ProjectService","Type","OperationService",function(e,t,n,o,c,i,a){function s(){e.status={collapsed:!1},r(),e.tags=n.getAllCustomTags(),e.timerTags=n.getAllTimerTags(),e.collapse=function(t){e.status.collapsed=!e.status.collapsed},e.animationsEnabled=!0}function r(){if(!c.getCurrentSelectObject())return void console.warn("空!");var n=c.getCurrentSelectObject().level,o=_.cloneDeep(n.actions);t.setActions(o),e.actions=t.getAllActions(),e.triggers=t.getTriggers(c.getCurrentSelectObject().level.type);var a=_.cloneDeep(c.getCurrentSelectObject().level);if(!a)return void console.warn("空!");switch(a.type){case i.MyButton:case i.MyNumber:case i.MyProgress:case i.MyDashboard:case i.MyButtonGroup:case i.MySubLayer:case i.MyPage:case i.MyNum:case i.MyImage:case i.MyScriptTrigger:case i.MySlideBlock:case i.MyTexNum:e.showActionPanel=!0;break;case i.MySlide:case i.MySwitch:default:e.showActionPanel=!1}switch(a.type){case i.MyPage:e.showAddActionPanel=!0;break;default:e.showAddActionPanel=!1}}function l(){e.$on("AttributeChanged",function(){r()}),e.deleteAction=function(n){t.deleteActionByIndex(n,function(){e.actions=t.getAllActions()}.bind(this))},e.openPanel=function(n){e.selectedIdx=n;var c;-1==n?(c=t.getNewAction(),c.newAction=!0):n>=0&&n<e.actions.length&&(c=_.cloneDeep(e.actions[n]),c.newAction=!1);for(var i=[],a=0;a<e.actions.length;a++)i.push(e.actions[a].title);o.open({animation:e.animationsEnabled,templateUrl:"actionPanelModal.html",controller:"ActionInstanceCtrl",size:"lg",resolve:{action:function(){return c},triggers:function(){return e.triggers},tags:function(){return e.tags},timerTags:function(){return e.timerTags},actionNames:function(){return i}}}).result.then(function(n){-1==e.selectedIdx?t.appendAction(n,function(){e.actions=t.getAllActions()}.bind(this)):e.selectedIdx>=0&&e.selectedIdx<e.actions.length&&t.updateActionByIndex(n,e.selectedIdx,function(){e.actions=t.getAllActions()}.bind(this))},function(){console.log("Modal dismissed at: "+new Date)})}}e.$on("GlobalProjectReceived",function(){s(),l(),e.$emit("LoadUp")}),e.$on("MaskView",function(t,n){e.myMask=n})}]).controller("ActionInstanceCtrl",["$scope","$uibModalInstance","ProjectService","action","triggers","tags","timerTags","actionNames","OperationService",function(e,t,n,o,c,i,a,s,r){function l(t){for(var n=e.actionNames,o=0;o<n.length;o++)if(t.action.title===n[o])return toastr.info("重复的动作名"),!1;return!0}var u=[{name:"",symbol:""},{tag:"",value:""},{tag:"",value:""}];e.ops=r.getOperations(),e.tags=_.map(i.filter(function(e){return"default"==e.bindMod}),"name"),e.timerTags=_.map(a,function(e){return e.name}),e.action=o,e.triggers=c,e.actionNames=s,e.currentChosenIdx=e.action.commands.length-1,e.currentChosenIdx>0?e.chosenCmd=e.action.commands[e.currentChosenIdx]:e.chosenCmd=_.cloneDeep(u),e.showCustomTags=!0,e.changeTagShowState=function(){-1!==e.chosenCmd[0].symbol.indexOf("setTimer")?e.showCustomTags=!1:e.showCustomTags=!0},e.checkValueIsInt=function(){var t=e.chosenCmd[2].value;t&&!_.isInteger(t)&&(toastr.warning("值只能为整数"),e.chosenCmd[2].value=parseInt(t))},e.chooseCmd=function(t){-1!==(e.action.commands[t][0].symbol||"").indexOf("setTimer")?e.showCustomTags=!1:e.showCustomTags=!0,e.currentChosenIdx=t,e.chosenCmd=e.action.commands[t]},e.addNewCmd=function(){e.action.commands.splice(e.currentChosenIdx+1,0,_.cloneDeep(u)),e.currentChosenIdx+=1,e.chosenCmd=e.action.commands[e.currentChosenIdx],""==e.action.trigger&&toastr.error("未选择触发方式！")},e.deleteCmd=function(t){e.action.commands.splice(t,1),e.currentChosenIdx-=1},e.save=function(n){if(!1===n.action.newAction&&n.action.title===d)return void t.close(e.action);g&&l(n)&&t.close(e.action)},e.cancel=function(){t.dismiss("cancel")};var d=e.action.title,g=!0;e.store=function(e){d=e.action.title},e.restore=function(e){e.action.title=d},e.enterName=function(t){if(t.action.title!==d){if(!(g=n.inputValidate(t.action.title,!0))||!l(t))return void e.restore(t);toastr.info("修改成功"),d=t.action.title}},e.enterPress=function(t,n){13==t.keyCode&&e.enterName(n)}}]);