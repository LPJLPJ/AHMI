ideServices.service("TagService",[function(){function e(e,n,t,i,s,r,a){this.name=e,this.register=n,this.indexOfRegister=t,this.writeOrRead=i,this.value=s,this.type=r||"custom",this.bindMod=a||"default"}function n(e){for(var n=m.map(function(e){return!1}),t=0;t<m.length;t++)for(var i=0;i<e.length;i++)if(e[i].name===m[t].name){n[t]=!0;break}for(t=0;t<n.length;t++)n[t]||e.push(m[t])}function t(e,n,t){this.name=e,this.type=n||"custom",this.tagArray=t||[]}function i(e){for(var n=new t("全部","system",d),i=new t("定时器","timer",T),s=[n,i],r=s.map(function(){return!1}),a=0;a<r.length;a++)for(var u=0;u<e.length;u++)if(e[u].name===s[a].name){r[a]=!0;break}for(a=0;a<r.length;a++)r[a]||e.push(s[a]);return e}function s(e){for(var n=d,t=0,i=n.length;t<i;t++)if(e.name===d[t].name)return void(d[t]=e)}var r=new e("",!1,null,"true",null,"custom","default"),a=new e("传递按键编码",!1,null,"true",0,"system","forbidden"),u=new e("视频",!1,null,"true",0,"system","forbidden"),o=new e("当前页面序号",!1,null,"true",0,"system","forbidden"),l=new e("时钟变量年月日",!1,null,"true",0,"system"),f=new e("时钟变量时分秒",!1,null,"true",0,"system"),g=new e("背光",!1,null,"true",0,"system"),c=new e("蜂鸣器",!1,null,"true",0,"system"),h=new e("帧率",!1,null,"true",0,"system"),m=[a,u,o,l,f,g,c,h],d=m,T=[],y=0,v=!0,p=!0;this.getNewTag=function(){return _.cloneDeep(r)},this.setUniqueTags=function(e,n,t){if(d.length+T.length>255)return void toastr.warning("超出tag数量限制");n(e,d)&&(d.push(e),t&&t())},this.syncAllTags=function(e){var t=[],i=[];if(e)for(var s=0;s<e.length;s++)0==e[s].name.indexOf("Sys")?i.push(e[s]):t.push(e[s]);n(t),d=t,T=i},this.syncCustomTags=function(e){n(e||[]),d=e},this.syncTimerTags=function(e){T=e||[]},this.getAllCustomTags=function(){return d},this.getAllTimerTags=function(){return T},this.getAllTags=function(){return d.concat(T)},this.getAllTagsName=function(){for(var e=d.concat(T),n=[],t=0;t<e.length;t++)n.push(e[t].name);return n},this.getTagByIndex=function(e){return d[e]},this.getTimerTagByIndex=function(e){return T[e]},this.deleteTagByIndex=function(e,n){e>=0&&e<=d.length-1&&(d.splice(e,1),n&&n())},this.deleteTagByName=function(e,n){for(var t=0;t<d.length;t++)d[t].name==e&&(d.splice(t,1),n&&n())},this.editTagByIndex=function(e,n,t){if(0!=d.length){var i=_.clone(n);d.splice(e,1,i),t&&t()}},this.editTimerTagByIndex=function(e,n,t){if(0!=T.length){var i={};_.assignIn(i,n),T.splice(e,1,i),t&&t()}},this.setTimerTags=function(e){T.length=0;for(var n=0;n<e;n++)T[n]={name:"",register:!1,indexOfRegister:null,value:0},T[n].name="SysTmr_"+n+"_t"},this.setTimerNum=function(e){y=e},this.getTimerNum=function(){return y},this.sortByName=function(e){var n=function(e,n){var t=e.name,i=n.name;return v?t.localeCompare(i,"zh"):i.localeCompare(t,"zh")};v=!v,d.sort(n),e&&e()},this.sortByRegister=function(e){var n=function(e,n){var t=e.indexOfRegister||-1,i=n.indexOfRegister||-1;return p?t-i:i-t};p=!p,d.sort(n),e&&e()},this.setTagsFromRemote=function(e,n){Object.assign(d,e),n&&n()};var w=new t("全部","system",d),x=new t("定时器","timer",T),B=new t("default","custom",[]),C=[w,x];this.getNewTagClass=function(){return _.cloneDeep(B)},this.addToTagClasses=function(e){var n=C.length;if(n>=30)return toastr.warning("超出标签数量限制"),!1;for(var t=0;t<n;t++)if(e.name===C[t].name)return toastr.warning("重复的标签名"),!1;return C.push(e),!0},this.syncTagClasses=function(e){C=i(e||[])},this.getAllTagClasses=function(){return i(C),C},this.getTagClassByIndex=function(e){return C[e]},this.deleteTagClassByIndex=function(e,n){e>=0&&e<=C.length-1&&(C.splice(e,1),n&&n())},this.editTagClassByIndex=function(e,n,t){if(!(C.length<=2)){var i=_.clone(n);C.splice(e,1,i),t&&t()}},this.syncTagFromRemote=function(e,n,t,i){for(var r=d,a=null,u=!1,o=0,l=e.length;o<l;o++){if(a=e[o],!(u=r.every(function(e){return e.name!==a.name}))&&t)s(a);else{if(!u&&!t)continue;r.push(a)}n.tagArray.push(a)}i&&i()}}]);