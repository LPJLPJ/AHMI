ideServices.service("TagService",[function(){function e(e,t,n,s,i,r,a){this.name=e,this.register=t,this.indexOfRegister=n,this.writeOrRead=s,this.value=i,this.type=r||"custom",this.bindMod=a||"default"}function t(e){for(var t=c.map(function(e){return!1}),n=0;n<c.length;n++)for(var s=0;s<e.length;s++)if(e[s].name===c[n].name){t[n]=!0;break}for(n=0;n<t.length;n++)t[n]||e.push(c[n])}function n(e,t,n){this.name=e,this.type=t||"custom",this.tagArray=n||[]}function s(e){for(var t=new n("全部","system",h),s=new n("定时器","timer",m),i=[t,s],r=i.map(function(){return!1}),a=0;a<r.length;a++)for(var u=0;u<e.length;u++)if(e[u].name===i[a].name){r[a]=!0;break}for(a=0;a<r.length;a++)r[a]||e.push(i[a]);return e}var i=new e("",!1,null,"true",null,"custom","default"),r=new e("传递按键编码",!1,null,"true",0,"system","forbidden"),a=new e("视频",!1,null,"true",0,"system","forbidden"),u=new e("当前页面序号",!1,null,"true",0,"system","forbidden"),l=new e("时钟变量年月日",!1,null,"true",0,"system"),o=new e("时钟变量时分秒",!1,null,"true",0,"system"),f=new e("背光",!1,null,"true",0,"system"),g=new e("蜂鸣器",!1,null,"true",0,"system"),c=[r,a,u,l,o,f,g],h=c,m=[],d=0,T=!0,y=!0;this.getNewTag=function(){return _.cloneDeep(i)},this.setUniqueTags=function(e,t,n){if(h.length+m.length>255)return void toastr.warning("超出tag数量限制");t(e,h)&&(h.push(e),n&&n())},this.syncAllTags=function(e){var n=[],s=[];if(e)for(var i=0;i<e.length;i++)0==e[i].name.indexOf("Sys")?s.push(e[i]):n.push(e[i]);t(n),h=n,m=s},this.syncCustomTags=function(e){t(e||[]),h=e},this.syncTimerTags=function(e){m=e||[]},this.getAllCustomTags=function(){return h},this.getAllTimerTags=function(){return m},this.getAllTags=function(){return h.concat(m)},this.getAllTagsName=function(){for(var e=h.concat(m),t=[],n=0;n<e.length;n++)t.push(e[n].name);return t},this.getTagByIndex=function(e){return h[e]},this.getTimerTagByIndex=function(e){return m[e]},this.deleteTagByIndex=function(e,t){e>=0&&e<=h.length-1&&(h.splice(e,1),t&&t())},this.deleteTagByName=function(e,t){for(var n=0;n<h.length;n++)h[n].name==e&&(h.splice(n,1),t&&t())},this.editTagByIndex=function(e,t,n){if(0!=h.length){var s=_.clone(t);h.splice(e,1,s),n&&n()}},this.editTimerTagByIndex=function(e,t,n){if(0!=m.length){var s={};_.assignIn(s,t),m.splice(e,1,s),n&&n()}},this.setTimerTags=function(e){m.length=0;for(var t=0;t<e;t++)m[t]={name:"",register:!1,indexOfRegister:null,value:0},m[t].name="SysTmr_"+t+"_t"},this.setTimerNum=function(e){d=e},this.getTimerNum=function(){return d},this.sortByName=function(e){var t=function(e,t){var n=e.name,s=t.name;return T?n.localeCompare(s,"zh"):s.localeCompare(n,"zh")};T=!T,h.sort(t),e&&e()},this.sortByRegister=function(e){var t=function(e,t){var n=e.indexOfRegister||-1,s=t.indexOfRegister||-1;return y?n-s:s-n};y=!y,h.sort(t),e&&e()},this.setTagsFromRemote=function(e,t){Object.assign(h,e),t&&t()};var v=new n("全部","system",h),p=new n("定时器","timer",m),w=new n("default","custom",[]),x=[v,p];this.getNewTagClass=function(){return _.cloneDeep(w)},this.addToTagClasses=function(e){var t=x.length;if(t>=30)return toastr.warning("超出标签数量限制"),!1;for(var n=0;n<t;n++)if(e.name===x[n].name)return toastr.warning("重复的标签名"),!1;return x.push(e),!0},this.syncTagClasses=function(e){x=s(e||[])},this.getAllTagClasses=function(){return s(x),x},this.getTagClassByIndex=function(e){return x[e]},this.deleteTagClassByIndex=function(e,t){e>=0&&e<=x.length-1&&(x.splice(e,1),t&&t())},this.editTagClassByIndex=function(e,t,n){if(!(x.length<=2)){var s=_.clone(t);h.splice(e,1,s),n&&n()}}}]);