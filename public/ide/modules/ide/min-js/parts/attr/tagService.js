ideServices.service("TagService",[function(){function e(e,t,n,s,i,r,a){this.name=e,this.register=t,this.indexOfRegister=n,this.writeOrRead=s,this.value=i,this.type=r||"custom",this.bindMod=a||"default"}function t(e){for(var t=h.map(function(e){return!1}),n=0;n<h.length;n++)for(var s=0;s<e.length;s++)if(e[s].name===h[n].name){t[n]=!0;break}for(n=0;n<t.length;n++)t[n]||e.push(h[n])}function n(e,t,n){this.name=e,this.type=t||"custom",this.tagArray=n||[]}function s(e){for(var t=new n("全部","system",m),s=new n("定时器","timer",d),i=[t,s],r=i.map(function(){return!1}),a=0;a<r.length;a++)for(var u=0;u<e.length;u++)if(e[u].name===i[a].name){r[a]=!0;break}for(a=0;a<r.length;a++)r[a]||e.push(i[a]);return e}var i=new e("",!1,null,"true",null,"custom","default"),r=new e("传递按键编码",!1,null,"true",0,"system","forbidden"),a=new e("视频",!1,null,"true",0,"system","forbidden"),u=new e("当前页面序号",!1,null,"true",0,"system","forbidden"),l=new e("时钟变量年月日",!1,null,"true",0,"system"),o=new e("时钟变量时分秒",!1,null,"true",0,"system"),f=new e("背光",!1,null,"true",0,"system"),g=new e("蜂鸣器",!1,null,"true",0,"system"),c=new e("帧率",!1,null,"true",0,"system"),h=[r,a,u,l,o,f,g,c],m=h,d=[],T=0,y=!0,v=!0;this.getNewTag=function(){return _.cloneDeep(i)},this.setUniqueTags=function(e,t,n){if(m.length+d.length>255)return void toastr.warning("超出tag数量限制");t(e,m)&&(m.push(e),n&&n())},this.syncAllTags=function(e){var n=[],s=[];if(e)for(var i=0;i<e.length;i++)0==e[i].name.indexOf("Sys")?s.push(e[i]):n.push(e[i]);t(n),m=n,d=s},this.syncCustomTags=function(e){t(e||[]),m=e},this.syncTimerTags=function(e){d=e||[]},this.getAllCustomTags=function(){return m},this.getAllTimerTags=function(){return d},this.getAllTags=function(){return m.concat(d)},this.getAllTagsName=function(){for(var e=m.concat(d),t=[],n=0;n<e.length;n++)t.push(e[n].name);return t},this.getTagByIndex=function(e){return m[e]},this.getTimerTagByIndex=function(e){return d[e]},this.deleteTagByIndex=function(e,t){e>=0&&e<=m.length-1&&(m.splice(e,1),t&&t())},this.deleteTagByName=function(e,t){for(var n=0;n<m.length;n++)m[n].name==e&&(m.splice(n,1),t&&t())},this.editTagByIndex=function(e,t,n){if(0!=m.length){var s=_.clone(t);m.splice(e,1,s),n&&n()}},this.editTimerTagByIndex=function(e,t,n){if(0!=d.length){var s={};_.assignIn(s,t),d.splice(e,1,s),n&&n()}},this.setTimerTags=function(e){d.length=0;for(var t=0;t<e;t++)d[t]={name:"",register:!1,indexOfRegister:null,value:0},d[t].name="SysTmr_"+t+"_t"},this.setTimerNum=function(e){T=e},this.getTimerNum=function(){return T},this.sortByName=function(e){var t=function(e,t){var n=e.name,s=t.name;return y?n.localeCompare(s,"zh"):s.localeCompare(n,"zh")};y=!y,m.sort(t),e&&e()},this.sortByRegister=function(e){var t=function(e,t){var n=e.indexOfRegister||-1,s=t.indexOfRegister||-1;return v?n-s:s-n};v=!v,m.sort(t),e&&e()},this.setTagsFromRemote=function(e,t){Object.assign(m,e),t&&t()};var p=new n("全部","system",m),w=new n("定时器","timer",d),x=new n("default","custom",[]),B=[p,w];this.getNewTagClass=function(){return _.cloneDeep(x)},this.addToTagClasses=function(e){var t=B.length;if(t>=30)return toastr.warning("超出标签数量限制"),!1;for(var n=0;n<t;n++)if(e.name===B[n].name)return toastr.warning("重复的标签名"),!1;return B.push(e),!0},this.syncTagClasses=function(e){B=s(e||[])},this.getAllTagClasses=function(){return s(B),B},this.getTagClassByIndex=function(e){return B[e]},this.deleteTagClassByIndex=function(e,t){e>=0&&e<=B.length-1&&(B.splice(e,1),t&&t())},this.editTagClassByIndex=function(e,t,n){if(!(B.length<=2)){var s=_.clone(t);m.splice(e,1,s),n&&n()}}}]);