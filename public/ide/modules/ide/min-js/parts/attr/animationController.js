ide.controller("animationCtl",["$scope","ProjectService","Type","$uibModal","AnimationService","UserTypeService",function(n,t,i,e,a,o){function r(){s(),l(),n.status={collapsed:!1},n.collapse=function(t){n.status.collapsed=!n.status.collapsed}}function l(){var n=o.getAnimationAuthor();document.getElementById("addAnimationBtn").disabled=n}function s(){if(!t.getCurrentSelectObject())return void console.warn("空");var i=t.getCurrentSelectObject().level,e=_.cloneDeep(i.animations);switch(a.setAnimations(e),n.animations=a.getAllAnimations(),t.getCurrentSelectObject().level.type){case"MyLayer":n.showAnimationPanel=!0;break;default:n.showAnimationPanel=!1}}function c(){n.$on("AttributeChanged",function(){s()}),n.deleteAnimation=function(t){a.deleteAnimationByIndex(t,function(){n.animations=a.getAllAnimations()}.bind(this))},n.openPanel=function(t){n.selectIdx=t;var i;-1==t?(i=a.getNewAnimation(),i.newAnimation=!0):t>=0&&t<n.animations.length&&(i=_.cloneDeep(n.animations[t]),i.newAnimation=!1);for(var o=[],r=0;r<n.animations.length;r++)o.push(n.animations[r].title);e.open({animation:!0,templateUrl:"animationPanelModal.html",controller:"AnimationInstanceCtrl",size:"middle",resolve:{animation:function(){return i},animationNames:function(){return o}}}).result.then(function(t){-1==n.selectIdx?a.appendAnimation(t,function(){n.animations=a.getAllAnimations()}.bind(this)):n.selectIdx>=0&&n.selectIdx<n.animations.length&&a.updateAnimationByIndex(t,n.selectIdx,function(){n.animations=a.getAllAnimations()}.bind(this))})}}n.$on("GlobalProjectReceived",function(){r(),c()}),n.$on("MaskView",function(t,i){n.myMask=i})}]).controller("AnimationInstanceCtrl",["$scope","$uibModalInstance","ProjectService","animation","animationNames",function(n,t,i,e,a){function o(t){for(var i=n.animationNames,e=0;e<i.length;e++)if(t.animation.title===i[e])return toastr.info("重复的动画名"),!1;return!0}n.animation=e,n.animationNames=a,n.checkDuration=function(t){n.animation.duration<0?(toastr.error("持续时间必须大于0s"),n.animation.duration=0):n.animation.duration>5e3&&(toastr.error("持续时间不能大于5s"),n.animation.duration=5e3)},n.confirm=function(i){var e=n.animation.animationAttrs.scale.srcScale.x,a=n.animation.animationAttrs.scale.srcScale.y;return e<0||a<0?void alert("缩放倍率禁止使用负数"):!1===i.animation.newAnimation&&i.animation.title===r?void t.close(n.animation):void(l&&o(i)&&t.close(n.animation))},n.cancel=function(){t.dismiss()};var r=n.animation.title,l=!0;n.store=function(n){r=n.animation.title},n.restore=function(n){n.animation.title=r},n.enterName=function(t){if(t.animation.title!==r){if(!(l=i.inputValidate(t.animation.title))||!o(t))return void n.restore(t);toastr.info("修改成功"),r=t.animation.title}},n.enterPress=function(t,i){13==t.keyCode&&n.enterName(i)}}]);