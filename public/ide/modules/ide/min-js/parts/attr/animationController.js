ide.controller("animationCtl",["$scope","ProjectService","Type","$uibModal","AnimationService","UserTypeService",function(n,t,i,e,a,o){function r(){m(),l(),n.status={collapsed:!1},n.collapse=function(t){n.status.collapsed=!n.status.collapsed}}function l(){var n=o.getAnimationAuthor();document.getElementById("addAnimationBtn").disabled=n}function m(){if(!t.getCurrentSelectObject())return void console.warn("空");var i=t.getCurrentSelectObject().level;switch(n.animations=_.cloneDeep(i.animations)||[],i.type){case"MyLayer":n.showAnimationPanel=!0;break;default:n.showAnimationPanel=!1}}function c(){n.$on("AttributeChanged",function(){m()}),n.deleteAnimation=function(i){i>=0&&i<n.animations.length&&(n.animations.splice(i,1),t.ChangeAttributeAnimation(_.cloneDeep(n.animations)))},n.openPanel=function(i){n.selectIdx=i;var o;-1==i?(o=a.getNewAnimation(),o.newAnimation=!0):i>=0&&i<n.animations.length&&(o=_.cloneDeep(n.animations[i]),o.newAnimation=!1);for(var r=[],l=0;l<n.animations.length;l++)r.push(n.animations[l].title);e.open({animation:!0,templateUrl:"animationPanelModal.html",controller:"AnimationInstanceCtrl",size:"middle",resolve:{animation:function(){return o},animationNames:function(){return r}}}).result.then(function(e){-1==n.selectIdx?(n.animations.push(e),t.ChangeAttributeAnimation(_.cloneDeep(n.animations))):n.selectIdx>=0&&n.selectIdx<n.animations.length&&i>=0&&i<n.animations.length&&(n.animations[i]=e,t.ChangeAttributeAnimation(_.cloneDeep(n.animations)))})}}n.$on("GlobalProjectReceived",function(){r(),c()})}]).controller("AnimationInstanceCtrl",["$scope","$uibModalInstance","ProjectService","animation","animationNames",function(n,t,i,e,a){function o(t){for(var i=n.animationNames,e=0;e<i.length;e++)if(t.animation.title===i[e])return toastr.info("重复的动画名"),!1;return!0}n.animation=e,n.animationNames=a,n.checkDuration=function(t){n.animation.duration<0?(toastr.error("持续时间必须大于0s"),n.animation.duration=0):n.animation.duration>5e3&&(toastr.error("持续时间不能大于5s"),n.animation.duration=5e3)},n.confirm=function(i){if(!1===i.animation.newAnimation&&i.animation.title===r)return void t.close(n.animation);l&&o(i)&&t.close(n.animation)},n.cancel=function(){t.dismiss()};var r=n.animation.title,l=!0;n.store=function(n){r=n.animation.title},n.restore=function(n){n.animation.title=r},n.enterName=function(t){if(t.animation.title!==r){if(!(l=i.inputValidate(t.animation.title))||!o(t))return void n.restore(t);toastr.info("修改成功"),r=t.animation.title}},n.enterPress=function(t,i){13==t.keyCode&&n.enterName(i)}}]);