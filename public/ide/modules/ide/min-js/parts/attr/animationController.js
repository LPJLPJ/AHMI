ide.controller("animationCtl",["$scope","ProjectService","Type","$uibModal","AnimationService","UserTypeService",function(n,t,i,e,o,a){function l(){c(),r(),n.status={collapsed:!1},n.collapse=function(t){n.status.collapsed=!n.status.collapsed}}function r(){var n=a.getAnimationAuthor();document.getElementById("addAnimationBtn").disabled=n}function c(){if(!t.getCurrentSelectObject())return void console.warn("空");var i=t.getCurrentSelectObject().level,e=_.cloneDeep(i.animations);switch(o.setAnimations(e),n.animations=o.getAllAnimations(),t.getCurrentSelectObject().level.type){case"MyLayer":n.showAnimationPanel=!0;break;default:n.showAnimationPanel=!1}}function s(){n.$on("AttributeChanged",function(){c()}),n.deleteAnimation=function(i){t.deleteAnimationName(o.getAllAnimations()[i].title),o.deleteAnimationByIndex(i,function(){n.animations=o.getAllAnimations()}.bind(this))},n.openPanel=function(t){n.selectIdx=t;var i;-1==t?i=o.getNewAnimation():t>=0&&t<n.animations.length&&(i=_.cloneDeep(n.animations[t])),e.open({animation:!0,templateUrl:"animationPanelModal.html",controller:"AnimationInstanceCtrl",size:"middle",resolve:{animation:function(){return i}}}).result.then(function(t){-1==n.selectIdx?o.appendAnimation(t,function(){n.animations=o.getAllAnimations()}.bind(this)):n.selectIdx>=0&&n.selectIdx<n.animations.length&&o.updateAnimationByIndex(t,n.selectIdx,function(){n.animations=o.getAllAnimations()}.bind(this))})}}n.$on("GlobalProjectReceived",function(){l(),s()})}]).controller("AnimationInstanceCtrl",["$scope","$uibModalInstance","ProjectService","animation",function(n,t,i,e){function o(n){r=_.cloneDeep(i.getAnimationArray());for(var t=0;t<r.length;t++)if(n.animation.title===r[t])return toastr.info("重复的动画名"),!1;return!0}n.animation=e,n.checkDuration=function(t){n.animation.duration<0?(toastr.error("持续时间必须大于0s"),n.animation.duration=0):n.animation.duration>5e3&&(toastr.error("持续时间不能大于5s"),n.animation.duration=5e3)},n.confirm=function(e){l&&o(e)&&(r.push(e.animation.title),i.setAnimationArray(r),t.close(n.animation))},n.cancel=function(){t.dismiss()};var a,l=!0,r=[];n.store=function(n){a=n.animation.title},n.restore=function(n){n.animation.title=a},n.enterName=function(t){if(t.animation.title!==a){if(!(l=i.inputValidate(t.animation.title))||!o(t))return void n.restore(t);toastr.info("修改成功"),i.deleteAnimationName(a),a=t.animation.title}},n.enterPress=function(t,i){13==t.keyCode&&n.enterName(i)}}]);