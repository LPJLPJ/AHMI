ide.controller("ResourceCtrl",["ResourceService","$scope","$timeout","ProjectService","Type","CanvasService","$uibModal",function(e,o,n,t,l,c,r){function s(){o.component={top:{uploadingArray:[],files:[],deleteFile:p,toggleOperation:i,basicUrl:"",resources:[],showDel:!0,selectIndexArr:[],selectAll:a,oppSelect:u,allSelected:!1,unSelAll:m}},o.component.top.resources=e.getAllResource(),o.component.top.basicUrl=e.getResourceUrl(),o.component.top.maxSize=e.getMaxTotalSize(),o.component.top.files=e.getAllCustomResources(),o.component.top.totalSize=e.getCurrentTotalSize(),o.openPanel=function(e,n){o.resIndex=e,r.open({animation:!0,templateUrl:"deletePanelModal.html",controller:"deleteResCtrl",size:"sm",resolve:{selectedResIndex:function(){return o.resIndex}}}).result.then(function(e){var o=[];if(_.isNumber(e))o.push(e),p(o);else if(_.isArray(e)){for(var t in e)e[t]&&o.push(Number(t));p(o),n&&n()}})}}function p(n){var l,c=t.getRequiredResourceNames(),r=_.cloneDeep(o.component.top.files),s=[],p=!0;for(l=0;l<n.length;l++){var i=n[l];p=c.every(function(e){return e!==r[i].src}),p?(s=r[i].id,e.deleteFileById(s,function(){o.$emit("ResourceUpdate")}.bind(this))):toastr.warning("资源-"+r[i].name+"已经被使用")}}function i(e){var n=!1,t=_.cloneDeep(o.component.top.selectIndexArr);switch(e){case"operate":o.component.top.showDel=!o.component.top.showDel;break;case"cancel":o.component.top.unSelAll(),o.component.top.selectIndexArr=[],o.component.top.showDel=!o.component.top.showDel;break;case"delete":n=!t.every(function(e){return!e}),n?(o.openPanel(t,function(){o.component.top.selectIndexArr=[]}),o.component.top.unSelAll()):toastr.warning("未选择文件！")}}function a(e){for(var n=0;n<o.component.top.files.length;n++)o.component.top.selectIndexArr[n]=e}function u(){o.component.top.unSelAll();for(var e=0;e<o.component.top.files.length;e++)null==o.component.top.selectIndexArr[e]?o.component.top.selectIndexArr[e]=!0:o.component.top.selectIndexArr[e]=!o.component.top.selectIndexArr[e]}function m(){o.component.top.allSelected=!1}o.$on("GlobalProjectReceived",function(){s()}),o.$on("ResourceChanged",function(){o.component.top.files=e.getAllCustomResources(),o.component.top.totalSize=e.getCurrentTotalSize(),o.$emit("ChangeCurrentPage")})}]).controller("deleteResCtrl",["$scope","$uibModalInstance","selectedResIndex",function(e,o,n){e.confirm=function(){o.close(n)},e.cancel=function(){o.dismiss("cancel")}}]);