ide.controller("ResourceCtrl",["ResourceService","$scope","$timeout","ProjectService","Type","CanvasService","$uibModal",function(e,o,n,t,r,c,l){function s(){o.component={top:{uploadingArray:[],files:[],deleteFile:i,toggleOperation:a,basicUrl:"",resources:[],showDel:!0,selectIndexArr:[]}},o.component.top.resources=e.getAllResource(),o.component.top.basicUrl=e.getResourceUrl(),o.component.top.maxSize=e.getMaxTotalSize(),o.component.top.files=e.getAllCustomResources(),o.component.top.totalSize=e.getCurrentTotalSize(),o.openPanel=function(e,n){o.resIndex=e,l.open({animation:!0,templateUrl:"deletePanelModal.html",controller:"deleteResCtrl",size:"sm",resolve:{selectedResIndex:function(){return o.resIndex}}}).result.then(function(e){var o=[];if(_.isNumber(e))o.push(e),i(o);else if(_.isArray(e)){for(var t in e)e[t]&&o.push(Number(t));i(o),n&&n()}})}}function i(n){var r,c=t.getRequiredResourceNames(),l=_.cloneDeep(o.component.top.files),s=[],i=!0;for(r=0;r<n.length;r++){var a=n[r];i=c.every(function(e){return e!==l[a].src}),i?(s=l[a].id,e.deleteFileById(s,function(){o.$emit("ResourceUpdate")}.bind(this))):toastr.warning("资源-"+l[a].name+"已经被使用")}}function a(e){var n=!1,t=_.cloneDeep(o.component.top.selectIndexArr);switch(e){case"operate":o.component.top.showDel=!o.component.top.showDel;break;case"cancel":o.component.top.selectIndexArr=[],o.component.top.showDel=!o.component.top.showDel;break;case"delete":n=!t.every(function(e){return!e}),n?o.openPanel(t,function(){o.component.top.selectIndexArr=[]}):toastr.warning("未选择文件！")}}o.$on("GlobalProjectReceived",function(){s()}),o.$on("ResourceChanged",function(){o.component.top.files=e.getAllCustomResources(),o.component.top.totalSize=e.getCurrentTotalSize(),o.$emit("ChangeCurrentPage")})}]).controller("deleteResCtrl",["$scope","$uibModalInstance","selectedResIndex",function(e,o,n){e.confirm=function(){o.close(n)},e.cancel=function(){o.dismiss("cancel")}}]);