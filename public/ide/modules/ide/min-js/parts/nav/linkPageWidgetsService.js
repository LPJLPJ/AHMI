ideServices.service("LinkPageWidgetsService",[function(){function e(e){e.linkedAllWidgets=i(s(e))}function t(e,t){if(!f){var o=document.createElement("canvas");f=o.getContext("2d")}f.save(),t&&(f.font=t);var i=f.measureText(e);return f.restore(),i.width}function o(e,t,o,i,s){this.type=e,this.target=t,this.value=o,this.left=i||0,this.top=s||0}function i(e){var i,s,n=[];for(i=0;i<e.length;i++)if(s=e[i],1!=s.info.disableHighlight)switch(s.subType){case"MyButtonGroup":var f=s.info.interval,u=s.info.count,a=s.info.width,l=s.info.height,b=0,p=0,r=!1;"horizontal"==s.info.arrange?(b=(a-f*(u-1))/u,r=!0):p=(l-f*(u-1))/u;for(var h=0;h<s.info.count;h++)n.push(new o(s.subType,s,h,s.info.absoluteLeft+(r?h*(b+f):0),s.info.absoluteTop+(r?0:h*(p+f))));break;case"MyDateTime":var T,d=s.info.dateTimeModeId,y=s.info.fontSize,w=s.info.fontFamily,c=y+"px "+w;if("0"==d){T=t(":",c),s.delimiterWidth=T;var L=(s.info.width-2*T)/3;n.push(new o(s.subType,s,0,s.info.absoluteLeft,s.info.absoluteTop)),n.push(new o(s.subType,s,1,s.info.absoluteLeft+L+T,s.info.absoluteTop)),n.push(new o(s.subType,s,2,s.info.absoluteLeft+2*(L+T),s.info.absoluteTop))}else if("1"==d){T=t(":",c),s.delimiterWidth=T;var L=(s.info.width-T)/2;n.push(new o(s.subType,s,0,s.info.absoluteLeft,s.info.absoluteTop)),n.push(new o(s.subType,s,1,s.info.absoluteLeft+L+T,s.info.absoluteTop))}else if("2"==d){T=t("/",c),s.delimiterWidth=T;var L=(s.info.width-2*T)/4;n.push(new o(s.subType,s,0,s.info.absoluteLeft,s.info.absoluteTop)),n.push(new o(s.subType,s,1,s.info.absoluteLeft+2*L+T,s.info.absoluteTop)),n.push(new o(s.subType,s,2,s.info.absoluteLeft+2*(L+T)+L,s.info.absoluteTop))}else if("3"==d){T=t("-",c),s.delimiterWidth=T;var L=(s.info.width-2*T)/4;n.push(new o(s.subType,s,0,s.info.absoluteLeft,s.info.absoluteTop)),n.push(new o(s.subType,s,1,s.info.absoluteLeft+2*L+T,s.info.absoluteTop)),n.push(new o(s.subType,s,2,s.info.absoluteLeft+2*(L+T)+L,s.info.absoluteTop))}break;case"MyTexTime":var d=s.info.dateTimeModeId,v=s.info.characterW;if("0"==d){T=t(":",c),s.delimiterWidth=v;var L=(s.info.width-2*v)/3;n.push(new o(s.subType,s,0,s.info.absoluteLeft,s.info.absoluteTop)),n.push(new o(s.subType,s,1,s.info.absoluteLeft+L+v,s.info.absoluteTop)),n.push(new o(s.subType,s,2,s.info.absoluteLeft+2*(L+v),s.info.absoluteTop))}else if("1"==d){s.delimiterWidth=v;var L=(s.info.width-v)/2;n.push(new o(s.subType,s,0,s.info.absoluteLeft,s.info.absoluteTop)),n.push(new o(s.subType,s,1,s.info.absoluteLeft+L+v,s.info.absoluteTop))}else if("2"==d){s.delimiterWidth=v;var L=(s.info.width-2*v)/4;n.push(new o(s.subType,s,0,s.info.absoluteLeft,s.info.absoluteTop)),n.push(new o(s.subType,s,1,s.info.absoluteLeft+2*L+v,s.info.absoluteTop)),n.push(new o(s.subType,s,2,s.info.absoluteLeft+2*(L+v)+L,s.info.absoluteTop))}else if("3"==d){s.delimiterWidth=v;var L=(s.info.width-2*v)/4;n.push(new o(s.subType,s,0,s.info.absoluteLeft,s.info.absoluteTop)),n.push(new o(s.subType,s,1,s.info.absoluteLeft+2*L+v,s.info.absoluteTop)),n.push(new o(s.subType,s,2,s.info.absoluteLeft+2*(L+v)+L,s.info.absoluteTop))}break;case"MyInputKeyboard":var g=s.info.keys;g.forEach(function(e,t){n.push(new o(s.subType,s,t,e.x,e.y))});break;case"general":for(var h=0;h<s.maxHighLightNum;h++)n.push(new o(s.subType,s,h,s.info.absoluteLeft,s.info.absoluteTop));break;default:n.push(new o(s.subType,s,0,s.info.absoluteLeft,s.info.absoluteTop))}return n.sort(function(e,t){return e.left-t.left}),n.sort(function(e,t){return e.top-t.top}),n}function s(e){for(var t,o,i,s=[],f=0,u=0;u<e.canvasList.length;u++){o=e.canvasList[u];for(var a=0;a<o.subCanvasList.length;a++){t=o.subCanvasList[a];for(var l=0;l<t.widgetList.length;l++){i=t.widgetList[l],i.wId=f++,i.info.absoluteLeft=i.info.left+o.x,i.info.absoluteTop=i.info.top+o.y;for(var b=i.texList||[],p=0;p<b.length;p++)for(var r=0;r<i.texList[p].slices.length;r++)delete i.texList[p].slices[r].$$hashKey}s=s.concat(t.widgetList)}}return s.filter(n)}function n(e){var t=!1;switch(e.subType){case"MyButton":case"MyButtonGroup":case"MyDateTime":case"MyTexTime":case"MyInputKeyboard":t=!0;break;case"general":t=!!e.enableHighLight;break;default:t=!1}return t}var f;this.linkPageAllWidgets=e}]);