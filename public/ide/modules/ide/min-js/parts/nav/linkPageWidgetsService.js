ideServices.service("LinkPageWidgetsService",[function(){function e(e){e.linkedAllWidgets=i(n(e))}function t(e,t){if(!a){var o=document.createElement("canvas");a=o.getContext("2d")}a.save(),t&&(a.font=t);var i=a.measureText(e);return a.restore(),i.width}function o(e,t,o,i,n){this.type=e,this.target=t,this.value=o,this.left=i||0,this.top=n||0}function i(e){var i,n,s=[];for(i=0;i<e.length;i++)if(n=e[i],1!=n.info.disableHighlight)switch(n.subType){case"MyButtonGroup":var a=n.info.interval,f=n.info.count,u=n.info.width,r=n.info.height,l=0,b=0,p=!1;"horizontal"==n.info.arrange?(l=(u-a*(f-1))/f,p=!0):b=(r-a*(f-1))/f;for(var h=0;h<n.info.count;h++)s.push(new o(n.subType,n,h,n.info.absoluteLeft+(p?h*(l+a):0),n.info.absoluteTop+(p?0:h*(b+a))));break;case"MyDateTime":var T,c=n.info.dateTimeModeId,d=n.info.fontSize,y=n.info.fontFamily,v=d+"px "+y;if("0"==c){T=t(":",v),n.delimiterWidth=T;var w=(n.info.width-2*T)/3;s.push(new o(n.subType,n,0,n.info.absoluteLeft,n.info.absoluteTop)),s.push(new o(n.subType,n,1,n.info.absoluteLeft+w+T,n.info.absoluteTop)),s.push(new o(n.subType,n,2,n.info.absoluteLeft+2*(w+T),n.info.absoluteTop))}else if("1"==c){T=t(":",v),n.delimiterWidth=T;var w=(n.info.width-T)/2;s.push(new o(n.subType,n,0,n.info.absoluteLeft,n.info.absoluteTop)),s.push(new o(n.subType,n,1,n.info.absoluteLeft+w+T,n.info.absoluteTop))}else if("2"==c){T=t("/",v),n.delimiterWidth=T;var w=(n.info.width-2*T)/4;s.push(new o(n.subType,n,0,n.info.absoluteLeft,n.info.absoluteTop)),s.push(new o(n.subType,n,1,n.info.absoluteLeft+2*w+T,n.info.absoluteTop)),s.push(new o(n.subType,n,2,n.info.absoluteLeft+2*(w+T)+w,n.info.absoluteTop))}else if("3"==c){T=t("-",v),n.delimiterWidth=T;var w=(n.info.width-2*T)/4;s.push(new o(n.subType,n,0,n.info.absoluteLeft,n.info.absoluteTop)),s.push(new o(n.subType,n,1,n.info.absoluteLeft+2*w+T,n.info.absoluteTop)),s.push(new o(n.subType,n,2,n.info.absoluteLeft+2*(w+T)+w,n.info.absoluteTop))}break;case"MyInputKeyboard":var L=n.info.keys;L.forEach(function(e,t){s.push(new o(n.subType,n,t,e.x,e.y))});break;case"general":for(var h=0;h<n.maxHighLightNum;h++)s.push(new o(n.subType,n,h,n.info.absoluteLeft,n.info.absoluteTop));break;default:s.push(new o(n.subType,n,0,n.info.absoluteLeft,n.info.absoluteTop))}return s.sort(function(e,t){return e.left-t.left}),s.sort(function(e,t){return e.top-t.top}),s}function n(e){for(var t,o,i,n=[],a=0,f=0;f<e.canvasList.length;f++){o=e.canvasList[f];for(var u=0;u<o.subCanvasList.length;u++){t=o.subCanvasList[u];for(var r=0;r<t.widgetList.length;r++)i=t.widgetList[r],i.wId=a++,i.info.absoluteLeft=i.info.left+o.x,i.info.absoluteTop=i.info.top+o.y;n=n.concat(t.widgetList)}}return n.filter(s)}function s(e){var t=!1;switch(e.subType){case"MyButton":case"MyButtonGroup":case"MyDateTime":case"MyInputKeyboard":t=!0;break;case"general":t=!!e.enableHighLight;break;default:t=!1}return t}var a;this.linkPageAllWidgets=e}]);