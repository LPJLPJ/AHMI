ideServices.service("ProjectTransformService",["Type",function(e){function t(e,t){return actionCompiler.transformer.trans(actionCompiler.parser.parse(e),t)}function n(e,n){if(n=n||!0,e&&e.actions&&e.actions.length)for(var r=0;r<e.actions.length;r++){var o=e.actions[r];o.commands=t(o.commands,n)}}function r(){var e=["onInitialize","onMouseUp","onMouseDown","onTagChange"],t={},n=WidgetModel.models;console.log("models",n);for(var r in n)if(n.hasOwnProperty(r)){var o=_.cloneDeep(n[r].prototype.commands);d(o,e),t[r]=o}return console.log("registered commands",t),t}function o(e){var t={};t.version=e.version,t.name=e.name||"default project",t.author=e.author||"author",t.size=e.currentSize,t.generalWidgetCommands=r(),t.pageList=[];for(var n=0;n<e.pages.length;n++)t.pageList.push(a(e.pages[n],n));return t}function a(t,r){var o={};o.id=""+r,o.type=e.MyPage,g(t,o,["name","backgroundImage","backgroundColor","triggers","actions","tag","transition"]),n(o),o.canvasList=[];for(var a=0;a<t.layers.length;a++)o.canvasList.push(i(t.layers[a],a,o.id));return o}function i(t,r,o){var a={};a.id=o+"."+r,a.type=e.MyLayer,g(t,a,["name","triggers","actions","tag","zIndex","animations","transition"]),n(a),a.w=t.info.width,a.h=t.info.height,a.x=t.info.left,a.y=t.info.top,a.subCanvasList=[];for(var i=0;i<t.subLayers.length;i++){var u=t.subLayers[i];t.showSubLayer.id==u&&(a.curSubCanvasIdx=i),a.subCanvasList.push(s(u,i,a.id))}return a}function s(t,r,o){var a={};a.id=o+"."+r,a.type=e.MySubLayer,g(t,a,["name","tag","actions","zIndex","backgroundImage","backgroundColor"]),n(a),a.widgetList=[];for(var i=0;i<t.widgets.length;i++){var s=t.widgets[i];a.widgetList.push(u(s,i,a.id))}return a}function u(e,t,r){var o={};if(o=_.cloneDeep(e),"general"==o.type){var a=o.info,i=a.left,s=a.top,u=a.width,d=a.height;o=new WidgetModel.models.Button(i,s,u,d,"button",null,o.texList[0].slices),o=o.toObject(),o.generalType="Button",o.id=r+"."+t,o.type="widget",o.subType="general"}else{var a=o.info,i=a.left,s=a.top,u=a.width,d=a.height;switch(o.type){case"MyButton":o=new WidgetModel.models.Button(i,s,u,d,"button",null,o.texList[0].slices),o=o.toObject(),o.generalType="Button",o.mode=Number(e.buttonModeId),o.subType="general";break;default:n(o),o.subType=e.type}o.id=r+"."+t,o.type="widget"}return o}function d(e,t){for(var n=0;n<t.length;n++){var r=t[n];c(e,r)}}function c(e,t){e[t]=WidgetModel.WidgetCommandParser.complier.transformer.trans(WidgetModel.WidgetCommandParser.complier.parser.parse(e[t])).map(function(e){return e.cmd})}function g(e,t,n){for(var r=0;r<n.length;r++){var o=n[r];"object"==typeof e[o]?t[o]=_.cloneDeep(e[o]):t[o]=e[o]}}this.transDataFile=o}]);