ideServices.service("ProjectTransformService",["Type",function(e){function o(e,o){return actionCompiler.transformer.trans(actionCompiler.parser.parse(e),o)}function t(e,t){if(t=t||!0,e&&e.actions&&e.actions.length)for(var n=0;n<e.actions.length;n++){var a=e.actions[n];a.commands=o(a.commands,t)}}function n(){var e=["onInitialize","onMouseUp","onMouseDown","onTagChange"],o={},t=WidgetModel.models,n=_.cloneDeep(WidgetCommands);for(var a in t)if(t.hasOwnProperty(a)){var r=_.cloneDeep(t[a].prototype.commands);d(r,e),o[a]=r}console.log("registered commands",o);var s={};for(var a in n)if(s[a]={},n.hasOwnProperty(a)){modelObj=n[a];for(var i=0;i<e.length;i++){var l=e[i];l in modelObj&&(modelObj[l]=ASTTransformer.transAST(widgetCompiler.parse(modelObj[l])),c(modelObj,l),s[a][l]=cppWidgetCommandTranslator.transJSWidgetCommands(modelObj[l]))}}return console.log("testModels",n),console.log("cppModels",s),{commands:n,cppModels:s}}function a(e){var o={};o.version=e.version,o.name=e.name||"default project",o.author=e.author||"author",o.size=e.currentSize;var t=n();o.generalWidgetCommands=t.commands,o.cppWidgetCommands=t.cppModels,o.pageList=[];for(var a=0;a<e.pages.length;a++)o.pageList.push(r(e.pages[a],a));return o}function r(o,n){var a={};a.id=""+n,a.type=e.MyPage,u(o,a,["name","backgroundImage","backgroundColor","triggers","actions","tag","transition"]),t(a),a.canvasList=[];for(var r=0;r<o.layers.length;r++)a.canvasList.push(s(o.layers[r],r,a.id));return a}function s(o,n,a){var r={};r.id=a+"."+n,r.type=e.MyLayer,u(o,r,["name","triggers","actions","tag","zIndex","animations","transition"]),t(r),r.w=o.info.width,r.h=o.info.height,r.x=o.info.left,r.y=o.info.top,r.subCanvasList=[];for(var s=0;s<o.subLayers.length;s++){var l=o.subLayers[s];o.showSubLayer.id==l&&(r.curSubCanvasIdx=s),r.subCanvasList.push(i(l,s,r.id))}return r}function i(o,n,a){var r={};r.id=a+"."+n,r.type=e.MySubLayer,u(o,r,["name","tag","actions","zIndex","backgroundImage","backgroundColor"]),t(r),r.widgetList=[];for(var s=0;s<o.widgets.length;s++){var i=o.widgets[s];r.widgetList.push(l(i,s,r.id))}return r}function l(e,o,n){var a={},r={};if(a=_.cloneDeep(e),t(a),"general"==a.type){var s=a.info,i=s.left,l=s.top,d=s.width,c=s.height;r=new WidgetModel.models.Button(i,l,d,c,"button",null,a.texList[0].slices),r=r.toObject(),r.generalType="Button",r.id=n+"."+o,r.type="widget",r.tag=e.tag,r.subType="general"}else{var s=a.info,i=s.left,l=s.top,d=s.width,c=s.height;switch(a.type){case"MyButton":r=new WidgetModel.models.Button(i,l,d,c,"button",null,a.texList[0].slices),r=r.toObject(),r.generalType="Button",r.mode=Number(e.buttonModeId),r.tag=_.cloneDeep(e.tag),r.subType="general",r.actions=a.actions;break;case"MyButtonGroup":var u=[];a.texList.map(function(e){u.push(e.slices[0]),u.push(e.slices[1])}),r=new WidgetModel.models.ButtonGroup(i,l,d,c,a.info.count||1,"horizontal"==a.info.arrange?0:1,a.info.interval||0,u),r=r.toObject(),r.tag=_.cloneDeep(e.tag),r.generalType="ButtonGroup",r.subType="general",r.actions=a.actions;break;case"MyDashboard":r=new WidgetModel.models.Dashboard(i,l,d,c,a.dashboardModeId,a.texList,a.info),r=r.toObject(),r.generalType="Dashboard",r.mode=Number(e.dashboardModeId),r.tag=_.cloneDeep(e.tag),r.subType="general";"minValue,maxValue,minAngle,maxAngle,lowAlarmValue,highAlarmValue".split(",").forEach(function(e){r[e]=s[e]||0}),r.otherAttrs[0]=s.offsetValue||0,r.otherAttrs[1]=Number(s.clockwise),r.actions=a.actions;break;case"MyProgress":var u=[];a.texList.map(function(e){u.push(e.slices[0])}),r=new WidgetModel.models.Progress(i,l,d,c,a.info.cursor,u),r=r.toObject(),r.tag=_.cloneDeep(e.tag),r.mode=Number(e.info.progressModeId),r.cursor=Number(e.info.cursor),r.minValue=Number(e.info.minValue),r.maxValue=Number(e.info.maxValue),r.actions=a.actions,r.generalType="Progress",r.subType="general";break;default:a.subType=e.type,r=a}r.id=n+"."+o,r.type="widget"}return r}function d(e,o){for(var t=0;t<o.length;t++){c(e,o[t])}}function c(e,o){o in e&&(e[o]=WidgetModel.WidgetCommandParser.complier.transformer.trans(WidgetModel.WidgetCommandParser.complier.parser.parse(e[o]),!0).map(function(e){return e.cmd}))}function u(e,o,t){for(var n=0;n<t.length;n++){var a=t[n];"object"==typeof e[a]?o[a]=_.cloneDeep(e[a]):o[a]=e[a]}}this.transDataFile=a}]);