ideServices.service("ProjectTransformService",["Type",function(e){function o(e,o){return actionCompiler.transformer.trans(actionCompiler.parser.parse(e),o)}function t(e,t){if(t=t||!0,e&&e.actions&&e.actions.length)for(var n=0;n<e.actions.length;n++){var a=e.actions[n];a.commands=o(a.commands,t)}}function n(){var e=["onInitialize","onMouseUp","onMouseDown","onTagChange"],o={},t=WidgetModel.models,n=_.cloneDeep(WidgetCommands);console.log("models",t);for(var a in t)if(t.hasOwnProperty(a)){var r=_.cloneDeep(t[a].prototype.commands);d(r,e),o[a]=r}console.log("registered commands",o);var i={};for(var a in n)if(i[a]={},n.hasOwnProperty(a)){modelObj=n[a];for(var s=0;s<e.length;s++){var l=e[s];l in modelObj&&(modelObj[l]=ASTTransformer.transAST(widgetCompiler.parse(modelObj[l])),g(modelObj,l),i[a][l]=cppWidgetCommandTranslator.transJSWidgetCommands(modelObj[l]))}}return console.log("testModels",n),console.log("cppModels",i),{commands:n,cppModels:i}}function a(e){var o={};o.version=e.version,o.name=e.name||"default project",o.author=e.author||"author",o.size=e.currentSize;var t=n();o.generalWidgetCommands=t.commands,o.cppWidgetCommands=t.cppModels,o.pageList=[];for(var a=0;a<e.pages.length;a++)o.pageList.push(r(e.pages[a],a));return o}function r(o,n){var a={};a.id=""+n,a.type=e.MyPage,c(o,a,["name","backgroundImage","backgroundColor","triggers","actions","tag","transition"]),t(a),a.canvasList=[];for(var r=0;r<o.layers.length;r++)a.canvasList.push(i(o.layers[r],r,a.id));return a}function i(o,n,a){var r={};r.id=a+"."+n,r.type=e.MyLayer,c(o,r,["name","triggers","actions","tag","zIndex","animations","transition"]),t(r),r.w=o.info.width,r.h=o.info.height,r.x=o.info.left,r.y=o.info.top,r.subCanvasList=[];for(var i=0;i<o.subLayers.length;i++){var l=o.subLayers[i];o.showSubLayer.id==l&&(r.curSubCanvasIdx=i),r.subCanvasList.push(s(l,i,r.id))}return r}function s(o,n,a){var r={};r.id=a+"."+n,r.type=e.MySubLayer,c(o,r,["name","tag","actions","zIndex","backgroundImage","backgroundColor"]),t(r),r.widgetList=[];for(var i=0;i<o.widgets.length;i++){var s=o.widgets[i];r.widgetList.push(l(s,i,r.id))}return r}function l(e,o,n){var a={};if(a=_.cloneDeep(e),"general"==a.type){var r=a.info,i=r.left,s=r.top,l=r.width,d=r.height;a=new WidgetModel.models.Button(i,s,l,d,"button",null,a.texList[0].slices),a=a.toObject(),a.generalType="Button",a.id=n+"."+o,a.type="widget",a.tag=e.tag,a.subType="general"}else{var r=a.info,i=r.left,s=r.top,l=r.width,d=r.height;switch(a.type){case"MyButton":a=new WidgetModel.models.Button(i,s,l,d,"button",null,a.texList[0].slices),a=a.toObject(),a.generalType="Button",a.mode=Number(e.buttonModeId),a.tag=_.cloneDeep(e.tag),a.subType="general";break;case"MyButtonGroup":var g=[];a.texList.map(function(e){g.push(e.slices[0]),g.push(e.slices[1])}),a=new WidgetModel.models.ButtonGroup(i,s,l,d,a.info.count||1,"horizontal"==a.info.arrange?0:1,a.info.interval||0,g),a=a.toObject(),a.tag=_.cloneDeep(e.tag),a.generalType="ButtonGroup",a.subType="general";break;case"MyDashboard":a=new WidgetModel.models.Dashboard(i,s,l,d,a.dashboardModeId,a.texList,a.info),a=a.toObject(),a.generalType="Dashboard",a.mode=Number(e.dashboardModeId),a.tag=_.cloneDeep(e.tag),a.subType="general",console.log("info",r);"minValue,maxValue,minAngle,maxAngle,lowAlarmValue,highAlarmValue".split(",").forEach(function(e){a[e]=r[e]||0}),a.otherAttrs[0]=r.offsetValue||0,console.log("targetWidget",a);break;default:t(a),a.subType=e.type}a.id=n+"."+o,a.type="widget"}return a}function d(e,o){for(var t=0;t<o.length;t++){g(e,o[t])}}function g(e,o){o in e&&(e[o]=WidgetModel.WidgetCommandParser.complier.transformer.trans(WidgetModel.WidgetCommandParser.complier.parser.parse(e[o]),!0).map(function(e){return e.cmd}))}function c(e,o,t){for(var n=0;n<t.length;n++){var a=t[n];"object"==typeof e[a]?o[a]=_.cloneDeep(e[a]):o[a]=e[a]}}this.transDataFile=a}]);