ideServices.service("ProjectTransformService",["Type",function(e){function t(e,t){return actionCompiler.transformer.trans(actionCompiler.parser.parse(e),t)}function o(e,o){if(o=o||!0,e&&e.actions&&e.actions.length)for(var n=0;n<e.actions.length;n++){var a=e.actions[n];a.commands=t(a.commands,o)}}function n(){var e=["onInitialize","onMouseUp","onMouseDown","onTagChange"],t={},o=WidgetModel.models,n=_.cloneDeep(WidgetCommands);console.log("models",o);for(var a in o)if(o.hasOwnProperty(a)){var r=_.cloneDeep(o[a].prototype.commands);d(r,e),t[a]=r}console.log("registered commands",t);var i={};for(var a in n)if(i[a]={},n.hasOwnProperty(a)){modelObj=n[a];for(var s=0;s<e.length;s++){var l=e[s];l in modelObj&&(modelObj[l]=ASTTransformer.transAST(widgetCompiler.parse(modelObj[l])),c(modelObj,l),i[a][l]=cppWidgetCommandTranslator.transJSWidgetCommands(modelObj[l]))}}return console.log("testModels",n),console.log("cppModels",i),{commands:n,cppModels:i}}function a(e){var t={};t.version=e.version,t.name=e.name||"default project",t.author=e.author||"author",t.size=e.currentSize;var o=n();t.generalWidgetCommands=o.commands,t.cppWidgetCommands=o.cppModels,t.pageList=[];for(var a=0;a<e.pages.length;a++)t.pageList.push(r(e.pages[a],a));return t}function r(t,n){var a={};a.id=""+n,a.type=e.MyPage,g(t,a,["name","backgroundImage","backgroundColor","triggers","actions","tag","transition"]),o(a),a.canvasList=[];for(var r=0;r<t.layers.length;r++)a.canvasList.push(i(t.layers[r],r,a.id));return a}function i(t,n,a){var r={};r.id=a+"."+n,r.type=e.MyLayer,g(t,r,["name","triggers","actions","tag","zIndex","animations","transition"]),o(r),r.w=t.info.width,r.h=t.info.height,r.x=t.info.left,r.y=t.info.top,r.subCanvasList=[];for(var i=0;i<t.subLayers.length;i++){var l=t.subLayers[i];t.showSubLayer.id==l&&(r.curSubCanvasIdx=i),r.subCanvasList.push(s(l,i,r.id))}return r}function s(t,n,a){var r={};r.id=a+"."+n,r.type=e.MySubLayer,g(t,r,["name","tag","actions","zIndex","backgroundImage","backgroundColor"]),o(r),r.widgetList=[];for(var i=0;i<t.widgets.length;i++){var s=t.widgets[i];r.widgetList.push(l(s,i,r.id))}return r}function l(e,t,n){var a={},r={};if(a=_.cloneDeep(e),o(a),"general"==a.type){var i=a.info,s=i.left,l=i.top,d=i.width,c=i.height;r=new WidgetModel.models.Button(s,l,d,c,"button",null,a.texList[0].slices),r=r.toObject(),r.generalType="Button",r.id=n+"."+t,r.type="widget",r.tag=e.tag,r.subType="general"}else{var i=a.info,s=i.left,l=i.top,d=i.width,c=i.height;switch(a.type){case"MyButton":r=new WidgetModel.models.Button(s,l,d,c,"button",null,a.texList[0].slices),r=r.toObject(),r.generalType="Button",r.mode=Number(e.buttonModeId),r.tag=_.cloneDeep(e.tag),r.subType="general",r.actions=a.actions;break;case"MyButtonGroup":var g=[];a.texList.map(function(e){g.push(e.slices[0]),g.push(e.slices[1])}),r=new WidgetModel.models.ButtonGroup(s,l,d,c,a.info.count||1,"horizontal"==a.info.arrange?0:1,a.info.interval||0,g),r=r.toObject(),r.tag=_.cloneDeep(e.tag),r.generalType="ButtonGroup",r.subType="general",r.actions=a.actions;break;case"MyDashboard":r=new WidgetModel.models.Dashboard(s,l,d,c,a.dashboardModeId,a.texList,a.info),r=r.toObject(),r.generalType="Dashboard",r.mode=Number(e.dashboardModeId),r.tag=_.cloneDeep(e.tag),r.subType="general";"minValue,maxValue,minAngle,maxAngle,lowAlarmValue,highAlarmValue".split(",").forEach(function(e){r[e]=i[e]||0}),r.otherAttrs[0]=i.offsetValue||0,r.otherAttrs[1]=Number(i.clockwise),r.actions=a.actions;break;default:a.subType=e.type,r=a}r.id=n+"."+t,r.type="widget"}return r}function d(e,t){for(var o=0;o<t.length;o++){c(e,t[o])}}function c(e,t){t in e&&(e[t]=WidgetModel.WidgetCommandParser.complier.transformer.trans(WidgetModel.WidgetCommandParser.complier.parser.parse(e[t]),!0).map(function(e){return e.cmd}))}function g(e,t,o){for(var n=0;n<o.length;n++){var a=o[n];"object"==typeof e[a]?t[a]=_.cloneDeep(e[a]):t[a]=e[a]}}this.transDataFile=a}]);