ideServices.service("ProjectTransformService",["Type",function(e){function t(e,t){return actionCompiler.transformer.trans(actionCompiler.parser.parse(e),t)}function n(e,n){if(n=n||!0,e&&e.actions&&e.actions.length)for(var o=0;o<e.actions.length;o++){var r=e.actions[o];r.commands=t(r.commands,n)}}function o(){var e=["onInitialize","onMouseUp","onMouseDown","onTagChange"],t={},n=WidgetModel.models,o=_.cloneDeep(WidgetCommands);for(var r in n)if(n.hasOwnProperty(r)){var a=_.cloneDeep(n[r].prototype.commands);d(a,e),t[r]=a}var s={};for(var r in o)if(s[r]={},o.hasOwnProperty(r)){modelObj=o[r];for(var i=0;i<e.length;i++){var l=e[i];l in modelObj&&(modelObj[l]=ASTTransformer.transAST(widgetCompiler.parse(modelObj[l])),g(modelObj,l),s[r][l]=cppWidgetCommandTranslator.transJSWidgetCommands(modelObj[l]))}}return console.log("testModels",o),console.log("cppModels",s),{commands:o,cppModels:s}}function r(e){var t={};t.version=e.version,t.name=e.name||"default project",t.author=e.author||"author",t.size=e.currentSize;var n=o();t.generalWidgetCommands=n.commands,t.cppWidgetCommands=n.cppModels,t.pageList=[];for(var r=0;r<e.pages.length;r++)t.pageList.push(a(e.pages[r],r));return t}function a(t,o){var r={};r.id=""+o,r.type=e.MyPage,c(t,r,["name","backgroundImage","backgroundColor","triggers","actions","tag","transition"]),n(r),r.canvasList=[];for(var a=0;a<t.layers.length;a++)r.canvasList.push(s(t.layers[a],a,r.id));return r}function s(t,o,r){var a={};a.id=r+"."+o,a.type=e.MyLayer,c(t,a,["name","triggers","actions","tag","zIndex","animations","transition"]),n(a),a.w=t.info.width,a.h=t.info.height,a.x=t.info.left,a.y=t.info.top,a.subCanvasList=[];for(var s=0;s<t.subLayers.length;s++){var l=t.subLayers[s];t.showSubLayer.id==l&&(a.curSubCanvasIdx=s),a.subCanvasList.push(i(l,s,a.id))}return a}function i(t,o,r){var a={};a.id=r+"."+o,a.type=e.MySubLayer,c(t,a,["name","tag","actions","zIndex","backgroundImage","backgroundColor"]),n(a),a.widgetList=[];for(var s=0;s<t.widgets.length;s++){var i=t.widgets[s];a.widgetList.push(l(i,s,a.id))}return a}function l(e,t,o){var r={};if(r=_.cloneDeep(e),"general"==r.type){var a=r.info,s=a.left,i=a.top,l=a.width,d=a.height;r=new WidgetModel.models.Button(s,i,l,d,"button",null,r.texList[0].slices),r=r.toObject(),r.generalType="Button",r.id=o+"."+t,r.type="widget",r.tag=e.tag,r.subType="general"}else{var a=r.info,s=a.left,i=a.top,l=a.width,d=a.height;switch(r.type){case"MyButton":r=new WidgetModel.models.Button(s,i,l,d,"button",null,r.texList[0].slices),r=r.toObject(),r.generalType="Button",r.mode=Number(e.buttonModeId),r.tag=_.cloneDeep(e.tag),r.subType="general";break;case"MyButtonGroup":var g=[];r.texList.map(function(e){g.push(e.slices[0]),g.push(e.slices[1])}),r=new WidgetModel.models.ButtonGroup(s,i,l,d,r.info.count||1,"horizontal"==r.info.arrange?0:1,r.info.interval||0,g),r=r.toObject(),r.tag=_.cloneDeep(e.tag),r.generalType="ButtonGroup",r.subType="general";break;case"MyProgress":var g=[];r.texList.map(function(e){g.push(e.slices[0])}),r=new WidgetModel.models.Progress(s,i,l,d,r.info.cursor,g),r=r.toObject(),r.tag=_.cloneDeep(e.tag),r.generalType="Progress",r.subType="general";break;default:console.log("only one",e.type),n(r),r.subType=e.type}r.id=o+"."+t,r.type="widget"}return r}function d(e,t){for(var n=0;n<t.length;n++){g(e,t[n])}}function g(e,t){t in e&&(e[t]=WidgetModel.WidgetCommandParser.complier.transformer.trans(WidgetModel.WidgetCommandParser.complier.parser.parse(e[t]),!0).map(function(e){return e.cmd}))}function c(e,t,n){for(var o=0;o<n.length;o++){var r=n[o];"object"==typeof e[r]?t[r]=_.cloneDeep(e[r]):t[r]=e[r]}}this.transDataFile=r}]);