ideServices.service("ProjectTransformService",["Type",function(e){function n(e,n){return actionCompiler.transformer.trans(actionCompiler.parser.parse(e),n)}function o(e,o){if(o=o||!0,e&&e.actions&&e.actions.length)for(var t=0;t<e.actions.length;t++){var r=e.actions[t];r.commands=n(r.commands,o)}}function t(){var e=["onInitialize","onMouseUp","onMouseDown","onTagChange"],n={},o=WidgetModel.models,t=_.cloneDeep(WidgetCommands);console.log("models",o);for(var r in o)if(o.hasOwnProperty(r)){var a=_.cloneDeep(o[r].prototype.commands);l(a,e),n[r]=a}console.log("registered commands",n);var i={};for(var r in t)if(i[r]={},t.hasOwnProperty(r)){modelObj=t[r];for(var s=0;s<e.length;s++){var d=e[s];d in modelObj&&(modelObj[d]=ASTTransformer.transAST(widgetCompiler.parse(modelObj[d])),c(modelObj,d),i[r][d]=cppWidgetCommandTranslator.transJSWidgetCommands(modelObj[d]))}}return console.log("cppModels",i),{commands:n,cppModels:i}}function r(e){var n={};n.version=e.version,n.name=e.name||"default project",n.author=e.author||"author",n.size=e.currentSize;var o=t();n.generalWidgetCommands=o.commands,n.cppWidgetCommands=o.cppModels,n.pageList=[];for(var r=0;r<e.pages.length;r++)n.pageList.push(a(e.pages[r],r));return n}function a(n,t){var r={};r.id=""+t,r.type=e.MyPage,u(n,r,["name","backgroundImage","backgroundColor","triggers","actions","tag","transition"]),o(r),r.canvasList=[];for(var a=0;a<n.layers.length;a++)r.canvasList.push(i(n.layers[a],a,r.id));return r}function i(n,t,r){var a={};a.id=r+"."+t,a.type=e.MyLayer,u(n,a,["name","triggers","actions","tag","zIndex","animations","transition"]),o(a),a.w=n.info.width,a.h=n.info.height,a.x=n.info.left,a.y=n.info.top,a.subCanvasList=[];for(var i=0;i<n.subLayers.length;i++){var d=n.subLayers[i];n.showSubLayer.id==d&&(a.curSubCanvasIdx=i),a.subCanvasList.push(s(d,i,a.id))}return a}function s(n,t,r){var a={};a.id=r+"."+t,a.type=e.MySubLayer,u(n,a,["name","tag","actions","zIndex","backgroundImage","backgroundColor"]),o(a),a.widgetList=[];for(var i=0;i<n.widgets.length;i++){var s=n.widgets[i];a.widgetList.push(d(s,i,a.id))}return a}function d(e,n,t){var r={};if(r=_.cloneDeep(e),"general"==r.type){var a=r.info,i=a.left,s=a.top,d=a.width,l=a.height;r=new WidgetModel.models.Button(i,s,d,l,"button",null,r.texList[0].slices),r=r.toObject(),r.generalType="Button",r.id=t+"."+n,r.type="widget",r.subType="general"}else{var a=r.info,i=a.left,s=a.top,d=a.width,l=a.height;switch(r.type){case"MyButton":r=new WidgetModel.models.Button(i,s,d,l,"button",null,r.texList[0].slices),r=r.toObject(),r.generalType="Button",r.mode=Number(e.buttonModeId),r.subType="general";break;case"MyButtonGroup":console.log(r);var c=[];r.texList.map(function(e){c.push(e.slices[0]),c.push(e.slices[1])}),r=new WidgetModel.models.ButtonGroup(i,s,d,l,r.info.count||1,"horizontal"==r.info.arrange?0:1,r.info.interval||0,c),r=r.toObject(),r.generalType="ButtonGroup",r.subType="general";break;default:o(r),r.subType=e.type}console.log(_.cloneDeep(r)),r.id=t+"."+n,r.type="widget"}return r}function l(e,n){for(var o=0;o<n.length;o++){var t=n[o];c(e,t)}}function c(e,n){n in e&&(e[n]=WidgetModel.WidgetCommandParser.complier.transformer.trans(WidgetModel.WidgetCommandParser.complier.parser.parse(e[n]),!0).map(function(e){return e.cmd}))}function u(e,n,o){for(var t=0;t<o.length;t++){var r=o[t];"object"==typeof e[r]?n[r]=_.cloneDeep(e[r]):n[r]=e[r]}}this.transDataFile=r}]);