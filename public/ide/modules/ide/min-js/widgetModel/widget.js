!function(e){if("function"==typeof define&&define.amd)define("WidgetModel",["./layer"],e);else if("object"==typeof module&&module.exports){console.log(__dirpath);var n=require("./layer");module.exports=e(n)}else window.WidgetModel=e(window.LayerModel)}(function(e){function n(e,n,t,s,r){this.info={left:e,top:n,width:t,height:s},this.tag="defaultTag",this.type="general",this.mode=0,this.otherAttrs=[],r&&r.length?this.layers=r:this.layers=[new c(t,s)]}function t(e,n){this.type=e,this.value=n}function s(e){var n=[],t={r:0,g:0,b:0,a:0};if(-1!==e.indexOf("rgba"))n=e.split(/[\(|\)]/)[1].split(",").map(function(e){return Number(e)}),t={r:n[0],g:n[1],b:n[2],a:255*n[3]};else{if(-1===e.indexOf("rgb"))throw new Error("parsing color error: "+e);n=e.split(/[\(|\)]/)[1].split(","),t={r:n[0],g:n[1],b:n[2],a:255}}return t}function r(e,t,r,a,o,i,w){var p,l=new c(0,0,r,a);l.subLayers.font=new u(o,i),l.subLayers.image=new h(w[0].imgSrc),p=s(w[0].color),l.subLayers.color=new y(p);var g=new c(0,0,r,a);g.subLayers.font=new u(o,i),g.subLayers.image=new h(w[1].imgSrc),p=s(w[1].color),g.subLayers.color=new y(p);var m=[l,g];this.subType="Button",n.call(this,e,t,r,a,m)}function a(e,t,r,a,o,i,w,p){var l,u=0,g=0,m=[];if(0==i){u=(r-(o-1)*w)/o,g=a;for(var d=0;d<o;d++){var b=new c(d*(u+w),0,u,g);b.subLayers.image=new h(p[2*d].imgSrc),l=s(p[2*d].color),b.subLayers.color=new y(l);var f=new c(d*(u+w),0,u,g,!0);f.subLayers.image=new h(p[2*d+1].imgSrc),l=s(p[2*d+1].color),f.subLayers.color=new y(l),m.push(b),m.push(f)}}this.subType="ButtonGroup",n.call(this,e,t,r,a,m)}function o(e,t,r,a,o,i,w){w=w||{};var p,u,g,m,d=[];if(0==o){p=[i[0].slices[0],i[1].slices[0]],u=new c(0,0,r,a),u.subLayers.image=new h(p[0].imgSrc),u.subLayers.color=new y(s(p[0].color));var b=w.pointerLength/Math.sqrt(2);g=new c(r/2,a/2,b,b),g.subLayers.image=new h(p[1].imgSrc),g.subLayers.color=new y(s(p[1].color)),d.push(u),d.push(g)}else if(1==o){p=[i[0].slices[0],i[1].slices[0],i[2].slices[0]],u=new c(0,0,r,a),u.subLayers.image=new h(p[0].imgSrc),u.subLayers.color=new y(s(p[0].color)),m=new c(0,0,r,a),m.subLayers.image=new h(p[2].imgSrc),m.subLayers.color=new y(s(p[2].color)),m.subLayers.roi=new l(1);var b=w.pointerLength/Math.sqrt(2);g=new c(r/2,a/2,b,b),g.subLayers.image=new h(p[1].imgSrc),g.subLayers.color=new y(s(p[1].color)),d.push(u),d.push(g),d.push(m)}else 2==o&&(p=[i[0].slices[0]],m=new c(0,0,r,a),m.subLayers.image=new h(p[0].imgSrc),m.subLayers.color=new y(s(p[0].color)),m.subLayers.roi=new l(1),d.push(m));n.call(this,e,t,r,a,d)}function i(e,t,r,a,o){var i,w=[];i=new c(0,0,r,a),i.subLayers.image=new h(o.imgSrc),i.subLayers.color=new y(s(o.color)),w.push(i),n.call(this,e,t,r,a,w)}function w(e,t,r,a,o,i,w){var p,l=[];p=new c(0,0,r,a),p.subLayers.font=new u(o,i),p.subLayers.image=new h(w.imgSrc),p.subLayers.color=new y(s(w.color)),l.push(p),n.call(this,e,t,r,a,l)}function p(e,t,r,a,o,i){var w,p=new c(0,0,r,a),u=new c(0,0,r,a),g=new c(0,0,r,a),m=Number(o.progressModeId),d=Number(o.cursor),b=i.length;w=s(i[0].color),p.subLayers.color=new y(w),p.subLayers.image=new h(i[0].imgSrc),0==m?(w=s(i[1].color),u.subLayers.color=new y(w),u.subLayers.image=new h(i[1].imgSrc),u.subLayers.roi=new l(0)):1==m?(w=s(i[1].color),u.subLayers.color=new y(w)):3==m&&(w=s(i[1].color),u.subLayers.color=new y(w)),1==d&&(g.subLayers.image=new h(i[b-1].imgSrc));var f=[p,u,g];this.subType="Progress",n.call(this,e,t,r,a,f)}var c=e.Layer,l=e.ROISubLayer,u=e.FontSubLayer,h=e.TextureSubLayer,y=e.ColorSubLayer;n.prototype.toObject=function(){return{info:{left:this.info.left,top:this.info.top,width:this.info.width,height:this.info.height},mode:this.mode,tag:this.tag,layers:this.layers,otherAttrs:this.otherAttrs}},n.prototype.commands={},n.execute=function(e,n,t){return"__tag"==n?this.getTag(e.tag):"string"==typeof n?'"'+n+'"':n};var g="Int",m="ID",d="EXP";r.prototype=Object.create(n.prototype),r.prototype.constructor=r,r.prototype.commands={},r.prototype.commands.onInitialize=[["temp","a",new t(d,"this.mode")],["setTag",new t(g,1)],["set",new t(m,"a"),new t(g,3)],["if"],["gte",new t(m,"a"),new t(g,100)],["set",new t(d,"this.layers.1.hidden"),new t(g,1)],["else"],["set",new t(d,"this.layers.1.hidden"),new t(g,0)],["end"]],r.prototype.commands.onMouseDown=[["temp","b",new t(d,"this.mode")],["print",new t(m,"b")],["if"],["eq",new t(m,"b"),new t(g,0)],["set",new t(d,"this.layers.0.hidden"),new t(g,1)],["set",new t(d,"this.layers.1.hidden"),new t(g,0)],["setTag",new t(g,0)],["else"],["temp","c",new t(g,0)],["getTag","c"],["if"],["gt",new t(m,"c"),new t(g,0)],["setTag",new t(g,0)],["else"],["setTag",new t(g,1)],["end"],["end"]],r.prototype.commands.onMouseUp=[["temp","b",new t(d,"this.mode")],["if"],["eq",new t(m,"b"),new t(g,0)],["set",new t(d,"this.layers.0.hidden"),new t(g,0)],["set",new t(d,"this.layers.1.hidden"),new t(g,1)],["setTag",new t(g,12)],["end"]],r.prototype.commands.onTagChange=[["temp","a",new t(g,0)],["temp","b",new t(d,"this.mode")],["getTag","a"],["if"],["eq",new t(m,"b"),new t(g,1)],["if"],["gt",new t(m,"a"),new t(g,0)],["set",new t(d,"this.layers.0.hidden"),new t(g,1)],["set",new t(d,"this.layers.1.hidden"),new t(g,0)],["else"],["set",new t(d,"this.layers.0.hidden"),new t(g,0)],["set",new t(d,"this.layers.1.hidden"),new t(g,1)],["end"],["end"]],a.prototype=Object.create(n.prototype),a.prototype.constructor=a,a.prototype.commands.onInitialize=[],a.prototype.commands.onMouseDown=[["temp","a",new t(g,0)],["temp","b",new t(g,0)],["temp","c",new t(g,0)],["set",new t(m,"c"),new t(d,"this.layers.length")],["minus","c",new t(g,2)],["set",new t(m,"a"),new t(d,"this.innerX")],["set",new t(m,"b"),new t(d,"this.innerY")],["temp","lx",new t(g,0)],["temp","ly",new t(g,0)],["temp","lw",new t(g,0)],["temp","lh",new t(g,0)],["temp","rx",new t(g,0)],["temp","ry",new t(g,0)],["while"],["gte",new t(m,"c"),new t(g,0)],["set",new t(m,"lx"),new t(d,"this.layers.c.x")],["set",new t(m,"ly"),new t(d,"this.layers.c.y")],["set",new t(m,"lw"),new t(d,"this.layers.c.width")],["set",new t(m,"lh"),new t(d,"this.layers.c.height")],["set",new t(m,"rx"),new t(m,"lx")],["set",new t(m,"ry"),new t(m,"ly")],["add","rx",new t(m,"lw")],["add","ry",new t(m,"lh")],["if"],["gte",new t(m,"a"),new t(m,"lx")],["if"],["gt",new t(m,"rx"),new t(m,"a")],["if"],["gte",new t(m,"b"),new t(m,"ly")],["if"],["gt",new t(m,"ry"),new t(m,"b")],["print",new t(m,"c"),"hit"],["divide","c",new t(g,2)],["setTag",new t(m,"c")],["set",new t(m,"c"),new t(g,0)],["end"],["end"],["end"],["end"],["minus","c",new t(g,2)],["end"]],a.prototype.commands.onMouseUp=[],a.prototype.commands.onTagChange=[["temp","a",new t(g,0)],["temp","b",new t(g,0)],["temp","c",new t(g,0)],["set",new t(m,"a"),new t(d,"this.layers.length")],["set",new t(m,"c"),new t(m,"a")],["divide","c",new t(g,2)],["while"],["gt",new t(m,"a"),new t(g,0)],["minus","a",new t(g,1)],["print",new t(m,"a")],["set",new t(d,"this.layers.a.hidden"),new t(g,1)],["minus","a",new t(g,1)],["set",new t(d,"this.layers.a.hidden"),new t(g,0)],["end"],["getTag","a"],["print",new t(m,"a")],["if"],["gte",new t(m,"a"),new t(g,0)],["if"],["gt",new t(m,"c"),new t(m,"a")],["multiply","a",new t(g,2)],["set",new t(d,"this.layers.a.hidden"),new t(g,1)],["add","a",new t(g,1)],["set",new t(d,"this.layers.a.hidden"),new t(g,0)],["end"],["end"]],o.prototype=Object.create(n.prototype),o.prototype.constructor=o,i.prototype=Object.create(n.prototype),i.prototype.constructor=i,w.prototype=Object.create(n.prototype),w.prototype.constructor=w,p.prototype=Object.create(n.prototype),p.prototype.constructor=p,p.prototype.commands.onInitialize=[["temp","a",new t(g,0)]],p.prototype.commands.onMouseDown=[["temp","a",new t(g,0)]],p.prototype.commands.onMouseUp=[["temp","a",new t(g,0)]],p.prototype.commands.onTagChange=[["temp","a",new t(g,0)]];var b={},f={};b.transCommand=function(e,t){var s,r,a,o=t[0];switch(o){case"temp":r=t[1],a=n.execute(e,t[2]),f[r]=a,s="var "+r+"="+a+";\n";break;case"set":r=t[1],a=n.execute(e,t[2]),r in f&&(f[r]=a),s=r+"="+a+";\n";break;case"if":s="if";break;case"pred":var i=t[2],w=t[3];i in f||(i=n.execute(e,i)),w in f||(w=n.execute(e,w)),s="("+i+t[1]+w+"){\n";break;case"else":s="}else{\n";break;case"end":s="}\n";break;case"setTag":s='WidgetExecutor.setTag("'+e.tag+'",'+t[1]+")"}return s},b.transFunction=function(e,n){f={};for(var t="",s=0;s<n.length;s++)t+=this.transCommand(e,n[s]);return t},b.complier={},function(e){"use strict";function n(e){for(var t=[],s=!0;e.length&&s;){var r,a=e[0];switch(a[0]){case"if":r={},r.type="IF",r.args=[],e.shift(),r.args.push(e.shift()),r.args.push(n(e)),"else"===e[0][0]&&(e.shift(),r.args.push(n(e))),e.shift(),t.push(r);break;case"while":r={type:"WHILE",args:[]},e.shift(),r.args.push(e.shift()),r.args.push(n(e)),e.shift(),t.push(r);break;case"else":case"end":s=!1;break;default:t.push({type:"EXP",args:[a]}),e.shift()}}return t}function t(e,n){this.label=String(e),this.cmd=n}function s(e,n){c=0;var t=a(e,n);return r(t),t}function r(e){for(var n,t={},s=0;s<e.length;s++)n=e[s],""!==n.label&&(t[n.label]=s);for(s=0;s<e.length;s++){n=e[s];var r=n.cmd;if("jump"===r[0]){var a=t[r[2]];r[2]=a-s}}}function a(e,n){for(var s=[],r=0;r<e.length;r++){var a=e[r];switch(a.type){case"EXP":s.push(new t("",a.args[0]));break;case"IF":[].push.apply(s,o(a,n));break;case"WHILE":[].push.apply(s,i(a,n));break;default:s.push(new t("",a.args[0]))}}return s}function o(e,n){var s=[],r=e.args;2===r.length&&r.push([]);var o=r[0],i=r[2],w=r[1];if(n=n||!1){var p=o[0],g=l[p];g&&(o[0]=g,i=r[1],w=r[2])}s.push(new t("",o));var m=c;c+=1,s.push(new t("",[u,y,m])),[].push.apply(s,a(w,n));var d=c;c+=1,s.push(new t("",[u,y,d]));var b=a(i,n);return b.length>0?b[0].label=String(m):b.push(new t(m,[h,"",""])),[].push.apply(s,b),s.push(new t(d,[h,"",""])),s}function i(e,n){var s=[],r=e.args,o=r[0],i=r[1],w=c++,p=c++,g=c++;if(n){var m=l[o[0]];m?(o[0]=m,s.push(new t(w,o)),s.push(new t("",[u,y,p])),s.push(new t("",[u,y,g]))):(s.push(new t(w,o)),s.push(new t("",[u,y,g])),s.push(new t("",[u,y,p])))}var d=a(i,n);return d.push(new t("",[u,y,w])),d[0].label=String(p),[].push.apply(s,d),s.push(new t(g,[h,"",""])),s}var w={};w.parse=n;var p={},c=0,l={gte:"lt",lte:"gt"};p.trans=s;var u="jump",h="end",y="";e.parser=w,e.transformer=p}(b.complier);var v={};return v.models={},v.models.Button=r,v.models.ButtonGroup=a,v.models.Dashboard=o,v.models.RotateImg=i,v.models.TextArea=w,v.models.Progress=p,v.Widget=n,v.WidgetCommandParser=b,v});