!function(e){"function"==typeof define&&define.amd?define("ASTTransformer",[],e):"object"==typeof module&&module.exports?module.exports=e():window.ASTTransformer=e()}(function(){function e(e,a){return{type:e,value:a}}function a(e){return e.sType&&"word"==e.sType}function r(e){return e.sType&&"compare"==e.sType}function t(e){switch(e.sType){case"number":return"Int";case"string":return-1!=e.value.indexOf("this")?"EXP":"String";case"word":return"ID"}}function u(e){switch(e){case"==":return"eq";case">":return"gt";case"<":return"lt";case">=":return"gte";case"<=":return"lte"}}function s(n){for(var o=[],i=0;i<n.length;i++){var l=n[i];if("function"==l.type){var p=l.args,v=p[1];switch(p[0]){case"var":if(!a(v[0]))throw new Error(c.paramNotMatch);o.push(["temp",v[0].value,e(t(v[1]),v[1].value)]);break;case"set":o.push(["set",e(t(v[0]),v[0].value),e(t(v[1]),v[1].value)]);break;case"setTag":o.push(["setTag",e(t(v[0]),v[0].value)]);break;case"getTag":o.push(["getTag",e(t(v[0]),v[0].value)]);break;case"print":o.push(["print",e(t(v[0]),v[0].value),e(t(v[1]),v[1].value)]);break;case"add":o.push(["add",e(t(v[0]),v[0].value),e(t(v[1]),v[1].value)]);break;case"minus":o.push(["minus",e(t(v[0]),v[0].value),e(t(v[1]),v[1].value)]);break;case"multiply":o.push(["multiply",e(t(v[0]),v[0].value),e(t(v[1]),v[1].value)]);break;case"divide":o.push(["divide",e(t(v[0]),v[0].value),e(t(v[1]),v[1].value)]);break;case"checkalarm":o.push(["checkalarm"]);break;case"setglobalvar":o.push(["setglobalvar",e(t(v[0]),v[0].value),e(t(v[1]),v[1].value)]);break;case"executeaction":o.push(["executeaction",e(t(v[0]),v[0].value)]);break;case"startanimation":o.push(["startanimation"]);break;case"mod":o.push(["mod",e(t(v[0]),v[0].value),e(t(v[1]),v[1].value)]);break;case"not":o.push(["not",e(t(v[0]),v[0].value)]);break;default:throw new Error("undefined op "+p[0])}}else if("if"==l.type){var p=l.args;if(!r(p[0]))throw new Error(c.paramNotMatch);o.push(["if"]);var h=p[0].args;o.push([u(h[1]),e(t(h[0]),h[0].value),e(t(h[2]),h[2].value)]),o=o.concat(s(p[1])),p[2]&&(o.push(["else"]),o=o.concat(s(p[2]))),o.push(["end"])}else if("while"==l.type){var p=l.args;if(!r(p[0]))throw new Error(c.paramNotMatch,JSON.stringify(p[0]));o.push(["while"]);var h=p[0].args;o.push([u(h[1]),e(t(h[0]),h[0].value),e(t(h[2]),h[2].value)]),o=o.concat(s(p[1])),o.push(["end"])}}return o}var n={},c={paramNotMatch:"param not match"};return n.transAST=s,n});